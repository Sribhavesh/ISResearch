<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAM„Éô„Éº„Çπ„ÅÆÊäÄË°ìÊã°Êï£„Ç®„Éº„Ç∏„Çß„É≥„Éà„É¢„Éá„É´</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 5px;
            font-size: 28px;
            font-weight: 600;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .simulation-container {
            display: grid;
            grid-template-columns: 800px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        #canvasContainer {
            background: #f7fafc;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        .controls {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 13px;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        .value-display {
            min-width: 45px;
            text-align: center;
            padding: 4px 8px;
            background: #edf2f7;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #2d3748;
        }
        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        .stat-label {
            font-size: 11px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }
        .stat-percentage {
            font-size: 12px;
            color: #48bb78;
            margin-left: 5px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        .chart {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }
        .legend {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .legend-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .model-description {
            background: #fef5e7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #f39c12;
        }
        .model-description h3 {
            color: #2d3748;
            margin-top: 0;
            font-size: 16px;
        }
        .model-description ul {
            margin: 10px 0;
            padding-left: 20px;
            line-height: 1.6;
            font-size: 13px;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ TAM„Éô„Éº„ÇπÊäÄË°ìÊã°Êï£„Ç®„Éº„Ç∏„Çß„É≥„Éà„É¢„Éá„É´</h1>
        <p class="subtitle">Technology Acceptance Model √ó Agent-Based Simulation</p>
        
        <div class="simulation-container">
            <div id="canvasContainer"></div>
            
            <div class="controls">
                <h3 style="margin-top: 0; color: #2d3748; font-size: 16px;">„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Âà∂Âæ°</h3>
                
                <div class="control-group">
                    <label>ÊäÄË°ì„ÅÆÊúâÁî®ÊÄß (Perceived Usefulness)</label>
                    <div class="slider-container">
                        <input type="range" id="usefulness" min="0" max="100" value="60">
                        <span class="value-display" id="usefulnessValue">60</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ÊäÄË°ì„ÅÆ‰Ωø„ÅÑ„ÇÑ„Åô„Åï (Perceived Ease of Use)</label>
                    <div class="slider-container">
                        <input type="range" id="easeOfUse" min="0" max="100" value="50">
                        <span class="value-display" id="easeOfUseValue">50</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>Á§æ‰ºöÁöÑÂΩ±ÈüøÂäõ (Social Influence)</label>
                    <div class="slider-container">
                        <input type="range" id="socialInfluence" min="0" max="100" value="30">
                        <span class="value-display" id="socialInfluenceValue">30</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>„Ç§„Éé„Éô„Éº„Çø„ÉºÊØîÁéá (%)</label>
                    <div class="slider-container">
                        <input type="range" id="innovators" min="1" max="20" value="5">
                        <span class="value-display" id="innovatorsValue">5%</span>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="startSimulation()">ÈñãÂßã</button>
                    <button class="btn-secondary" onclick="pauseSimulation()">‰∏ÄÊôÇÂÅúÊ≠¢</button>
                    <button class="btn-secondary" onclick="resetSimulation()">„É™„Çª„ÉÉ„Éà</button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">Êé°Áî®ËÄÖÊï∞</div>
                        <div class="stat-value">
                            <span id="adopters">0</span>
                            <span class="stat-percentage" id="adoptersPercent">0%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ê§úË®é‰∏≠</div>
                        <div class="stat-value">
                            <span id="considering">0</span>
                            <span class="stat-percentage" id="consideringPercent">0%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ÊôÇÈñìÁµåÈÅé</div>
                        <div class="stat-value" id="timeStep">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-title">„Ç®„Éº„Ç∏„Çß„É≥„ÉàÁä∂ÊÖã</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #90EE90;"></div>
                    <span>„Ç§„Éé„Éô„Éº„Çø„ÉºÔºàÂàùÊúüÊé°Áî®ËÄÖÔºâ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4169E1;"></div>
                    <span>Êé°Áî®ËÄÖ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFD700;"></div>
                    <span>Ê§úË®é‰∏≠</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #D3D3D3;"></div>
                    <span>Êú™Ë™çÁü•</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF6B6B;"></div>
                    <span>ÊãíÂê¶ËÄÖ</span>
                </div>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart">
                <div class="chart-title">üìà Êé°Áî®Áéá„ÅÆÊé®Áßª</div>
                <div id="adoptionChart"></div>
            </div>
            <div class="chart">
                <div class="chart-title">üìä „Ç®„Éº„Ç∏„Çß„É≥„ÉàÂàÜÂ∏É</div>
                <div id="distributionChart"></div>
            </div>
        </div>
        
        <div class="model-description">
            <h3>„É¢„Éá„É´„ÅÆË™¨Êòé</h3>
            <ul>
                <li><strong>„Ç®„Éº„Ç∏„Çß„É≥„ÉàË°åÂãï</strong>ÔºöÂêÑ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅØÂÄãÂà•„ÅÆPUÔºàÊúâÁî®ÊÄßÔºâ„Å®PEOUÔºà‰Ωø„ÅÑ„ÇÑ„Åô„ÅïÔºâ„ÅÆÈñæÂÄ§„ÇíÊåÅ„Å°„ÄÅÊäÄË°ìË©ï‰æ°„ÇíË°å„ÅÑ„Åæ„Åô</li>
                <li><strong>Á§æ‰ºöÁöÑÂΩ±Èüø</strong>ÔºöËøëÈö£„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÊé°Áî®Áä∂Ê≥Å„ÅåÂÄã‰∫∫„ÅÆÊé°Áî®Ê±∫ÂÆö„Å´ÂΩ±ÈüøÔºàTAM2„É¢„Éá„É´„ÅÆË¶ÅÁ¥†Ôºâ</li>
                <li><strong>Êé°Áî®„Éó„É≠„Çª„Çπ</strong>ÔºöÊú™Ë™çÁü•‚ÜíÊ§úË®é‰∏≠‚ÜíÊé°Áî®/ÊãíÂê¶„ÅÆÊÆµÈöéÁöÑÈÅ∑Áßª</li>
                <li><strong>„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂäπÊûú</strong>ÔºöÊé°Áî®ËÄÖ„ÅÆÂ¢óÂä†„Å´„Çà„Çä„ÄÅ‰ªñËÄÖ„ÅÆÁü•Ë¶ö„Åï„Çå„ÅüÊúâÁî®ÊÄß„ÅåÂêë‰∏ä</li>
                <li><strong>ÂÄã‰∫∫Â∑Æ</strong>ÔºöÈù©Êñ∞ÊÄß„ÄÅ„É™„Çπ„ÇØË®±ÂÆπÂ∫¶„ÄÅÊäÄË°ìË¶™ÂíåÊÄß„Åå„Ç®„Éº„Ç∏„Çß„É≥„Éà„Åî„Å®„Å´Áï∞„Å™„Çã</li>
            </ul>
        </div>
    </div>

    <script>
        // ========================================
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„ÅÆÂÆöÁæ©
        // ========================================

        // agents: „Åô„Åπ„Å¶„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„ÉàÔºàÂÄã‰∫∫Ôºâ„ÇíÊ†ºÁ¥ç„Åô„ÇãÈÖçÂàó
        // ÂêÑ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅØÊäÄË°ì„ÇíÊé°Áî®„Åô„Çã„Åã„Å©„ÅÜ„ÅãÁã¨Ëá™„Å´Âà§Êñ≠„Åô„ÇãÂÄã‰∫∫„ÇíË°®„Åó„Åæ„Åô
        let agents = [];

        // time: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆÁµåÈÅéÊôÇÈñìÔºà„Çπ„ÉÜ„ÉÉ„ÉóÊï∞Ôºâ
        // 1„Çπ„ÉÜ„ÉÉ„Éó„ÅØÂÆü‰∏ñÁïå„ÅÆ1Êó•„ÇÑ1ÈÄ±Èñì„Å™„Å©„Å´Áõ∏ÂΩì„Åô„Çã„Å®ËÄÉ„Åà„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô
        let time = 0;

        // isRunning: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅåÂÆüË°å‰∏≠„Åã„Å©„ÅÜ„Åã„ÇíÁÆ°ÁêÜ„Åô„Çã„Éï„É©„Ç∞
        // true = ÂÆüË°å‰∏≠„ÄÅfalse = ÂÅúÊ≠¢‰∏≠
        let isRunning = false;

        // adoptionHistory: Êé°Áî®Áéá„ÅÆÊôÇÁ≥ªÂàó„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åô„ÇãÈÖçÂàó
        // „Ç∞„É©„ÉïÊèèÁîª„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô
        let adoptionHistory = [];

        // canvas: p5.js„ÅÆ„Ç≠„É£„É≥„Éê„Çπ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
        // „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÂãï„Åç„ÇíÊèèÁîª„Åô„ÇãÈ†òÂüü„Åß„Åô
        let canvas;

        // ========================================
        // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ë®≠ÂÆö„Éë„É©„É°„Éº„Çø
        // ========================================

        // NUM_AGENTS: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Å´ÂèÇÂä†„Åô„Çã„Ç®„Éº„Ç∏„Çß„É≥„ÉàÔºàÂÄã‰∫∫Ôºâ„ÅÆÁ∑èÊï∞
        // Â§ö„ÅÑ„Åª„Å©ÁèæÂÆüÁöÑ„Åß„Åô„Åå„ÄÅÂá¶ÁêÜ„ÅåÈáç„Åè„Å™„Çä„Åæ„Åô
        const NUM_AGENTS = 400;

        // CANVAS_WIDTH, CANVAS_HEIGHT: ÊèèÁîªÈ†òÂüü„ÅÆ„Çµ„Ç§„Ç∫Ôºà„Éî„ÇØ„Çª„É´Âçò‰ΩçÔºâ
        const CANVAS_WIDTH = 780;
        const CANVAS_HEIGHT = 500;
        
        // ========================================
        // Agent„ÇØ„É©„ÇπÔºöÂÄã„ÄÖ„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„ÉàÔºàÂÄã‰∫∫Ôºâ„ÇíË°®Áèæ
        // ========================================
        // ÂêÑ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅØÁã¨Ëá™„ÅÆÊÄßÊ†º„ÇÑÂà§Êñ≠Âü∫Ê∫ñ„ÇíÊåÅ„Å°„ÄÅ
        // Âë®Âõ≤„ÅÆÂΩ±Èüø„ÇíÂèó„Åë„Å™„Åå„ÇâÊäÄË°ìÊé°Áî®„ÇíÊ±∫ÂÆö„Åó„Åæ„Åô
        class Agent {
            constructor(x, y, id) {
                // ========== Âü∫Êú¨Â±ûÊÄß ==========
                // id: „Åì„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÂõ∫ÊúâË≠òÂà•Áï™Âè∑
                this.id = id;

                // x, y: „Ç≠„É£„É≥„Éê„Çπ‰∏ä„ÅÆÁèæÂú®‰ΩçÁΩÆÔºàÂ∫ßÊ®ôÔºâ
                this.x = x;
                this.y = y;

                // vx, vy: ÁßªÂãïÈÄüÂ∫¶ÔºàvelocityÔºâ„ÅÆxÊàêÂàÜ„Å®yÊàêÂàÜ
                // „Ç®„Éº„Ç∏„Çß„É≥„Éà„Åå„É©„É≥„ÉÄ„É†„Å´Âãï„ÅçÂõû„Çã„Åü„ÇÅ„Å´‰ΩøÁî®
                this.vx = 0;
                this.vy = 0;

                // ========== TAM„É¢„Éá„É´„ÅÆ„Éë„É©„É°„Éº„ÇøÔºàÂÄã‰∫∫Â∑Æ„ÇíË°®ÁèæÔºâ==========

                // puThreshold: Perceived UsefulnessÔºàÁü•Ë¶ö„Åï„Çå„ÅüÊúâÁî®ÊÄßÔºâ„ÅÆÈñæÂÄ§
                // „Åì„ÅÆÂÄ§„Åå‰Ωé„ÅÑ‰∫∫„Åª„Å©„ÄÅÂ∞ë„Åó„ÅÆÊúâÁî®ÊÄß„Åß„ÇÇÊäÄË°ì„ÇíÊé°Áî®„Åó„ÇÑ„Åô„ÅÑ
                // random(20, 80)„Åß20„Äú80„ÅÆÈñì„ÅÆ„É©„É≥„ÉÄ„É†„Å™ÂÄ§„ÇíË®≠ÂÆö
                this.puThreshold = random(20, 80);

                // peouThreshold: Perceived Ease of UseÔºàÁü•Ë¶ö„Åï„Çå„Åü‰Ωø„ÅÑ„ÇÑ„Åô„ÅïÔºâ„ÅÆÈñæÂÄ§
                // „Åì„ÅÆÂÄ§„Åå‰Ωé„ÅÑ‰∫∫„Åª„Å©„ÄÅ‰Ωø„ÅÑ„Å´„Åè„ÅÑÊäÄË°ì„Åß„ÇÇÂèó„ÅëÂÖ•„Çå„ÇÑ„Åô„ÅÑ
                this.peouThreshold = random(20, 80);

                // innovativeness: Èù©Êñ∞ÊÄßÔºà„Ç§„Éé„Éô„Éº„ÉÜ„Ç£„Éñ„ÅïÔºâ
                // 0„Äú100„ÅÆÂÄ§„Åß„ÄÅÈ´ò„ÅÑ„Åª„Å©Êñ∞„Åó„ÅÑÊäÄË°ì„Å´Á©çÊ•µÁöÑ
                // RogersÁêÜË´ñ„ÅÆ„Äå„Ç§„Éé„Éô„Éº„Çø„Éº„Äç„Äå„Ç¢„Éº„É™„Éº„Ç¢„ÉÄ„Éó„Çø„Éº„Äç„Å™„Å©„Å´Áõ∏ÂΩì
                this.innovativeness = random(0, 100);

                // ========== „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ ==========

                // state: ÁèæÂú®„ÅÆÊé°Áî®Áä∂ÊÖã„ÇíË°®„ÅôÊï∞ÂÄ§
                // 0 = Êú™Ë™çÁü•ÔºàÊäÄË°ì„ÅÆÂ≠òÂú®„ÇíÁü•„Çâ„Å™„ÅÑÔºâ
                // 1 = Ê§úË®é‰∏≠ÔºàÊäÄË°ì„ÇíÁü•„Å£„Å¶Ë©ï‰æ°„Åó„Å¶„ÅÑ„ÇãÔºâ
                // 2 = Êé°Áî®ÔºàÊäÄË°ì„Çí‰Ωø„ÅÑÂßã„ÇÅ„ÅüÔºâ
                // 3 = ÊãíÂê¶ÔºàÊ§úË®é„ÅÆÁµêÊûú„ÄÅ‰Ωø„Çè„Å™„ÅÑ„Åì„Å®„Å´Ê±∫„ÇÅ„ÅüÔºâ
                this.state = 0;

                // considerationTime: Ê§úË®é„ÇíÂßã„ÇÅ„Å¶„Åã„Çâ„ÅÆÁµåÈÅéÊôÇÈñì
                // ‰∫∫„ÅØÂç≥Â∫ß„Å´Ê±∫ÂÆö„Åõ„Åö„ÄÅÊôÇÈñì„Çí„Åã„Åë„Å¶Ê§úË®é„Åó„Åæ„Åô
                this.considerationTime = 0;

                // maxConsiderationTime: Ê§úË®é„Å´„Åã„Åë„ÇãÊúÄÂ§ßÊôÇÈñì
                // „Åì„ÅÆÊôÇÈñì„ÅåÁµåÈÅé„Åó„Åü„ÇâÊé°Áî®„ÅãÊãíÂê¶„Åã„ÇíÊ±∫ÂÆö
                // 10„Äú50„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÈñì„Åß„É©„É≥„ÉÄ„É†„Å´Ë®≠ÂÆöÔºàÂÄã‰∫∫Â∑ÆÔºâ
                this.maxConsiderationTime = random(10, 50);

                // ========== „ÇΩ„Éº„Ç∑„É£„É´„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ ==========

                // neighbors: Ëøë„Åè„Å´„ÅÑ„Çã‰ªñ„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆ„É™„Çπ„Éà
                // Á§æ‰ºöÁöÑÂΩ±Èüø„ÇíË®àÁÆó„Åô„Çã„Åü„ÇÅ„Å´‰ΩøÁî®
                this.neighbors = [];

                // influenceRadius: ÂΩ±Èüø„Çí‰∏é„Åà„Çã/Âèó„Åë„ÇãÁØÑÂõ≤ÔºàÂçäÂæÑÔºâ
                // „Åì„ÅÆÁØÑÂõ≤ÂÜÖ„Å´„ÅÑ„Çã‰ªñËÄÖ„Åã„ÇâÁ§æ‰ºöÁöÑÂΩ±Èüø„ÇíÂèó„Åë„Åæ„Åô
                this.influenceRadius = 50;
            }
            
            // ========================================
            // update: „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞„Åô„Çã„É°„Ç§„É≥„É°„ÇΩ„ÉÉ„Éâ
            // ========================================
            // ÊØé„Éï„É¨„Éº„É†Âëº„Å∞„Çå„ÄÅ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁßªÂãï„Å®ÊÑèÊÄùÊ±∫ÂÆö„ÇíÂá¶ÁêÜ„Åó„Åæ„Åô
            update(techPU, techPEOU, socialInfluence) {
                // techPU: ÊäÄË°ì„ÅÆÊúâÁî®ÊÄßÔºà0-100Ôºâ
                // techPEOU: ÊäÄË°ì„ÅÆ‰Ωø„ÅÑ„ÇÑ„Åô„ÅïÔºà0-100Ôºâ
                // socialInfluence: Á§æ‰ºöÁöÑÂΩ±Èüø„ÅÆÂº∑„ÅïÔºà0-100Ôºâ

                // ========== 1. „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁßªÂãïÂá¶ÁêÜ ==========
                // „É©„É≥„ÉÄ„É†„Ç¶„Ç©„Éº„ÇØÔºöÁèæÂÆü‰∏ñÁïå„Åß„ÅÆ‰∫∫„ÅÆÁßªÂãï„ÇíÊ®°Êì¨

                // ÈÄüÂ∫¶„Å´„É©„É≥„ÉÄ„É†„Å™Âä†ÈÄüÂ∫¶„ÇíËøΩÂä†Ôºà-0.5„Äú0.5„ÅÆÁØÑÂõ≤Ôºâ
                // „Åì„Çå„Å´„Çà„Çä‰∫àÊ∏¨‰∏çÂèØËÉΩ„Å™Ëá™ÁÑ∂„Å™Âãï„Åç„ÇíÂÆüÁèæ
                this.vx += random(-0.5, 0.5);
                this.vy += random(-0.5, 0.5);

                // ÈÄüÂ∫¶„Å´Ê∏õË°∞„Çí„Åã„Åë„ÇãÔºà0.95„ÇíÊéõ„Åë„ÇãÔºâ
                // „Åì„Çå„Åå„Å™„ÅÑ„Å®ÁÑ°Èôê„Å´Âä†ÈÄü„Åó„Å¶„Åó„Åæ„ÅÜ„Åü„ÇÅ
                this.vx *= 0.95;
                this.vy *= 0.95;

                // ÈÄüÂ∫¶„Çí‰ΩçÁΩÆ„Å´ÂèçÊò†ÔºàÂÆüÈöõ„ÅÆÁßªÂãïÔºâ
                this.x += this.vx;
                this.y += this.vy;

                // ========== 2. Â¢ÉÁïåÂá¶ÁêÜÔºàÂ£Å„ÅÆÂÆüË£ÖÔºâ==========
                // „Ç®„Éº„Ç∏„Çß„É≥„Éà„Åå„Ç≠„É£„É≥„Éê„Çπ„ÅÆÂ§ñ„Å´Âá∫„Å™„ÅÑ„Çà„ÅÜ„Å´Âà∂Èôê
                if (this.x < 10) this.x = 10;                           // Â∑¶Á´Ø
                if (this.x > CANVAS_WIDTH - 10) this.x = CANVAS_WIDTH - 10;  // Âè≥Á´Ø
                if (this.y < 10) this.y = 10;                           // ‰∏äÁ´Ø
                if (this.y > CANVAS_HEIGHT - 10) this.y = CANVAS_HEIGHT - 10; // ‰∏ãÁ´Ø

                // ========== 3. Á§æ‰ºöÁöÑ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆÊõ¥Êñ∞ ==========
                // Ëøë„Åè„Å´„ÅÑ„Çã‰ªñ„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÊ§úÂá∫
                this.findNeighbors();

                // ========== 4. Áä∂ÊÖãÈÅ∑Áßª„É≠„Ç∏„ÉÉ„ÇØÔºàÊÑèÊÄùÊ±∫ÂÆö„ÅÆ‰∏≠Ê†∏Ôºâ==========

                if (this.state === 0) { // „ÄêÊú™Ë™çÁü•Áä∂ÊÖã„Äë„ÅÆÂá¶ÁêÜ
                    // „Åæ„Å†ÊäÄË°ì„ÅÆÂ≠òÂú®„ÇíÁü•„Çâ„Å™„ÅÑÁä∂ÊÖã

                    // ËøëÈö£„ÅÆÊé°Áî®ËÄÖÊï∞„Çí„Ç´„Ç¶„É≥„Éà
                    // filter: Êù°‰ª∂„Å´Âêà„ÅÜ„Ç®„Éº„Ç∏„Çß„É≥„Éà„Å†„Åë„ÇíÊäΩÂá∫
                    // a.state === 2: Êé°Áî®Ê∏à„Åø„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„Éà
                    let adoptedNeighbors = this.neighbors.filter(a => a.state === 2).length;

                    // Ë™çÁü•„ÅÆ„Åç„Å£„Åã„ÅëÔºö
                    // 1. Ëøë„Åè„Å´Êé°Áî®ËÄÖ„Åå„ÅÑ„ÇãÔºàÂè£„Ç≥„ÉüÂäπÊûúÔºâ
                    // 2. „Åæ„Åü„ÅØ„É©„É≥„ÉÄ„É†„Å´Ë™çÁü•ÔºàÂ∫ÉÂëä„Å™„Å©„ÇíÊÉ≥ÂÆö„ÄÅ0.5%„ÅÆÁ¢∫ÁéáÔºâ
                    if (adoptedNeighbors > 0 || random(100) < 0.5) {
                        this.state = 1; // Ê§úË®é‰∏≠Áä∂ÊÖã„Å∏ÁßªË°å
                    }

                } else if (this.state === 1) { // „ÄêÊ§úË®é‰∏≠Áä∂ÊÖã„Äë„ÅÆÂá¶ÁêÜ
                    // ÊäÄË°ì„ÇíÁü•„Å£„Å¶„ÄÅÊé°Áî®„Åô„Çã„ÅãÊ§úË®é„Åó„Å¶„ÅÑ„ÇãÁä∂ÊÖã

                    // Ê§úË®éÊôÇÈñì„Çí„Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó
                    this.considerationTime++;

                    // ========== TAM„É¢„Éá„É´„Å´Âü∫„Å•„ÅèË©ï‰æ°Ë®àÁÆó ==========

                    // Âü∫Êú¨ÁöÑ„Å™Áü•Ë¶öÂÄ§Ôºà„Çπ„É©„Ç§„ÉÄ„Éº„ÅßË®≠ÂÆö„Åï„Çå„ÅüÂÄ§Ôºâ
                    let perceivedPU = techPU;     // Áü•Ë¶ö„Åï„Çå„ÅüÊúâÁî®ÊÄß
                    let perceivedPEOU = techPEOU; // Áü•Ë¶ö„Åï„Çå„Åü‰Ωø„ÅÑ„ÇÑ„Åô„Åï

                    // ========== Á§æ‰ºöÁöÑÂΩ±Èüø„ÅÆË®àÁÆó ==========
                    // Âë®Âõ≤„ÅÆÊé°Áî®ËÄÖ„ÅÆÂâ≤Âêà„Åã„ÇâÂΩ±Èüø„ÇíÂèó„Åë„Çã

                    // ËøëÈö£„ÅÆÊé°Áî®ËÄÖÊï∞„ÇíÂÜçÂ∫¶„Ç´„Ç¶„É≥„Éà
                    let adoptedNeighbors = this.neighbors.filter(a => a.state === 2).length;

                    // Êé°Áî®ËÄÖ„ÅÆÂâ≤Âêà„ÇíË®àÁÆóÔºà0„Äú1„ÅÆÂÄ§Ôºâ
                    // max(this.neighbors.length, 1): „Çº„É≠Èô§ÁÆó„ÇíÈò≤„Åê
                    let neighborInfluence = (adoptedNeighbors / max(this.neighbors.length, 1)) * socialInfluence;

                    // ========== „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂäπÊûú„ÅÆÈÅ©Áî® ==========
                    // Âë®Âõ≤„Å´Êé°Áî®ËÄÖ„ÅåÂ§ö„ÅÑ„Åª„Å©„ÄÅÊäÄË°ì„Åå„Çà„ÇäÊúâÁî®„Åß‰Ωø„ÅÑ„ÇÑ„Åô„ÅèÊÑü„Åò„Çã
                    perceivedPU += neighborInfluence * 0.5;   // ÊúâÁî®ÊÄß„ÅØ50%ÂΩ±Èüø„ÇíÂèó„Åë„Çã
                    perceivedPEOU += neighborInfluence * 0.3; // ‰Ωø„ÅÑ„ÇÑ„Åô„Åï„ÅØ30%ÂΩ±Èüø„ÇíÂèó„Åë„Çã

                    // ========== Êé°Áî®ÊÑèÂõ≥„ÅÆË®àÁÆóÔºàTAM„É¢„Éá„É´„ÅÆ‰∏≠Ê†∏Ôºâ==========
                    // Êé°Áî®ÊÑèÂõ≥ = ÊúâÁî®ÊÄß√ó60% + ‰Ωø„ÅÑ„ÇÑ„Åô„Åï√ó40%
                    // „Åï„Çâ„Å´ÂÄã‰∫∫„ÅÆÈù©Êñ∞ÊÄß„ÅßË™øÊï¥ÔºàÈù©Êñ∞ÁöÑ„Å™‰∫∫„Åª„Å©Êé°Áî®„Åó„ÇÑ„Åô„ÅÑÔºâ
                    let intention = (perceivedPU * 0.6 + perceivedPEOU * 0.4) * (1 + this.innovativeness / 200);

                    // ========== ÊúÄÁµÇÁöÑ„Å™ÊÑèÊÄùÊ±∫ÂÆö ==========
                    // ÂçÅÂàÜ„Å™Ê§úË®éÊôÇÈñì„ÅåÁµåÈÅé„Åó„Åü„ÇâÊ±∫ÂÆö„Çí‰∏ã„Åô
                    if (this.considerationTime > this.maxConsiderationTime) {
                        // Êé°Áî®ÊÑèÂõ≥„ÅåÂÄã‰∫∫„ÅÆÈñæÂÄ§„ÇíË∂Ö„Åà„Åü„ÇâÊé°Áî®„ÄÅ„Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞ÊãíÂê¶
                        if (intention > (this.puThreshold * 0.6 + this.peouThreshold * 0.4)) {
                            this.state = 2; // Êé°Áî®ÔºÅ
                        } else {
                            this.state = 3; // ÊãíÂê¶
                        }
                    }
                }
                // Ê≥®ÔºöÊé°Áî®Ôºàstate=2Ôºâ„ÇÑÊãíÂê¶Ôºàstate=3Ôºâ„Å´„Å™„Å£„Åü„Çâ„ÄÅ„Åù„ÅÆÁä∂ÊÖã„ÅØÂ§â„Çè„Çâ„Å™„ÅÑ
            }
            
            // ========================================
            // findNeighbors: ËøëÈö£„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÊ§úÂá∫
            // ========================================
            // Á§æ‰ºöÁöÑÂΩ±Èüø„ÇíË®àÁÆó„Åô„Çã„Åü„ÇÅ„ÄÅÂΩ±ÈüøÁØÑÂõ≤ÂÜÖ„ÅÆ‰ªñËÄÖ„ÇíÁâπÂÆö„Åó„Åæ„Åô
            findNeighbors() {
                // filterÈñ¢Êï∞„ÅßÊù°‰ª∂„Å´Âêà„ÅÜ„Ç®„Éº„Ç∏„Çß„É≥„Éà„Å†„Åë„ÇíÊäΩÂá∫
                this.neighbors = agents.filter(a => {
                    // Ëá™ÂàÜËá™Ë∫´„ÅØÈô§Â§ñÔºàËá™ÂàÜ„ÅßËá™ÂàÜ„Å´ÂΩ±Èüø„Åó„Å™„ÅÑÔºâ
                    if (a === this) return false;

                    // distÈñ¢Êï∞Ôºö2ÁÇπÈñì„ÅÆË∑ùÈõ¢„ÇíË®àÁÆóÔºàp5.js„ÅÆÈñ¢Êï∞Ôºâ
                    // ‚àö((x2-x1)¬≤ + (y2-y1)¬≤) „ÇíË®àÁÆó
                    let d = dist(this.x, this.y, a.x, a.y);

                    // ÂΩ±ÈüøÁØÑÂõ≤ÂÜÖÔºàinfluenceRadius‰ª•ÂÜÖÔºâ„Å´„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    return d < this.influenceRadius;
                });
            }
            
            // ========================================
            // display: „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÁîªÈù¢„Å´ÊèèÁîª
            // ========================================
            // Ë¶ñË¶öÁöÑ„Å´„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁä∂ÊÖã„ÇíË°®Áèæ„Åó„Åæ„Åô
            display() {
                // push()„Å®pop()ÔºöÊèèÁîªË®≠ÂÆö„Çí‰∏ÄÊôÇÁöÑ„Å´‰øùÂ≠ò„ÉªÂæ©ÂÖÉ
                // ‰ªñ„ÅÆÊèèÁîª„Å´ÂΩ±Èüø„Çí‰∏é„Åà„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
                push();

                // ========== ÂΩ±ÈüøÁØÑÂõ≤„ÅÆÂèØË¶ñÂåñ ==========
                // Êé°Áî®ËÄÖ„ÅÆ„Åø„ÄÅ„Åù„ÅÆÂΩ±ÈüøÁØÑÂõ≤„ÇíËñÑ„ÅÑÈùí„ÅÑÂÜÜ„ÅßË°®Á§∫
                if (this.state === 2) {
                    noStroke();                    // Êû†Á∑ö„Å™„Åó
                    fill(65, 105, 225, 30);       // ÈùíËâ≤„ÄÅÈÄèÊòéÂ∫¶30ÔºàËñÑ„ÅÑÈùíÔºâ
                    // Áõ¥ÂæÑ„ÅØÂΩ±ÈüøÂçäÂæÑ„ÅÆ2ÂÄçÔºàcircleÈñ¢Êï∞„ÅØÁõ¥ÂæÑ„ÇíÊåáÂÆöÔºâ
                    circle(this.x, this.y, this.influenceRadius * 2);
                }

                // ========== „Ç®„Éº„Ç∏„Çß„É≥„ÉàÊú¨‰Ωì„ÅÆÊèèÁîªË®≠ÂÆö ==========
                let col;      // Ëâ≤„ÇíÊ†ºÁ¥ç„Åô„ÇãÂ§âÊï∞
                let size = 8; // „Éá„Éï„Ç©„É´„Éà„Çµ„Ç§„Ç∫

                // Áä∂ÊÖã„Å´Âøú„Åò„Å¶Ëâ≤„Å®„Çµ„Ç§„Ç∫„ÇíÊ±∫ÂÆö
                switch(this.state) {
                    case 0: // Êú™Ë™çÁü•
                        col = color(211, 211, 211);  // „Ç∞„É¨„ÉºÔºàÁü•„Çâ„Å™„ÅÑÁä∂ÊÖã„ÇíË°®ÁèæÔºâ
                        break;
                    case 1: // Ê§úË®é‰∏≠
                        col = color(255, 215, 0);     // ÈªÑËâ≤ÔºàËÄÉ„Åà„Å¶„ÅÑ„ÇãÁä∂ÊÖã„ÇíË°®ÁèæÔºâ
                        size = 10;                    // Â∞ë„ÅóÂ§ß„Åç„ÅèÔºàÊ≥®ÁõÆ„Åó„Å¶„ÅÑ„ÇãÔºâ
                        break;
                    case 2: // Êé°Áî®
                        col = color(65, 105, 225);    // ÈùíÔºàÊé°Áî®Ê∏à„Åø„ÇíË°®ÁèæÔºâ
                        size = 12;                    // Â§ß„Åç„ÅèÔºàÈáçË¶Å„Å™Â≠òÂú®Ôºâ
                        break;
                    case 3: // ÊãíÂê¶
                        col = color(255, 107, 107);   // Ëµ§ÔºàÊãíÂê¶„ÇíË°®ÁèæÔºâ
                        size = 6;                     // Â∞è„Åï„ÅèÔºàÈñ¢ÂøÉ„ÇíÂ§±„Å£„ÅüÔºâ
                        break;
                }

                // ========== „Ç§„Éé„Éô„Éº„Çø„Éº„ÅÆÁâπÂà•Ë°®Á§∫ ==========
                // Èù©Êñ∞ÊÄß„Åå90‰ª•‰∏ä„Åã„Å§Êé°Áî®Ê∏à„Åø„ÅÆ‰∫∫„ÅØ„Äå„Ç§„Éé„Éô„Éº„Çø„Éº„Äç„Å®„Åó„Å¶Á∑ëËâ≤„ÅßË°®Á§∫
                if (this.innovativeness > 90 && this.state === 2) {
                    col = color(144, 238, 144); // „É©„Ç§„Éà„Ç∞„É™„Éº„É≥
                    size = 14;                  // ÊúÄÂ§ß„Çµ„Ç§„Ç∫ÔºàÂΩ±ÈüøÂäõ„ÅåÂ§ß„Åç„ÅÑÔºâ
                }

                // ========== „Ç®„Éº„Ç∏„Çß„É≥„ÉàÊú¨‰Ωì„ÇíÊèèÁîª ==========
                stroke(255, 100);      // ÁôΩ„ÅÑÊû†Á∑öÔºàÈÄèÊòéÂ∫¶100Ôºâ
                strokeWeight(2);       // Êû†Á∑ö„ÅÆÂ§™„Åï2„Éî„ÇØ„Çª„É´
                fill(col);            // Â°ó„Çä„Å§„Å∂„ÅóËâ≤„ÇíË®≠ÂÆö
                circle(this.x, this.y, size); // ÂÜÜ„ÇíÊèèÁîª

                // ========== „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂öÁ∑ö„ÅÆÊèèÁîª ==========
                // Êé°Áî®ËÄÖÂêåÂ£´„ÅÆ„Å§„Å™„Åå„Çä„ÇíÁ∑ö„ÅßÂèØË¶ñÂåñ
                if (this.state === 2) {
                    stroke(65, 105, 225, 50);  // ËñÑ„ÅÑÈùíËâ≤„ÅÆÁ∑ö
                    strokeWeight(1);           // Á¥∞„ÅÑÁ∑ö

                    // forEachÔºöÂêÑËøëÈö£„Ç®„Éº„Ç∏„Çß„É≥„Éà„Å´ÂØæ„Åó„Å¶Âá¶ÁêÜ
                    this.neighbors.forEach(n => {
                        // Áõ∏Êâã„ÇÇÊé°Áî®ËÄÖ„Å™„ÇâÁ∑ö„ÇíÂºï„Åè
                        if (n.state === 2) {
                            line(this.x, this.y, n.x, n.y);
                        }
                    });
                }

                pop(); // ÊèèÁîªË®≠ÂÆö„ÇíÂÖÉ„Å´Êàª„Åô
            }
        }
        
        // ========================================
        // setup: p5.js„ÅÆÂàùÊúüÂåñÈñ¢Êï∞
        // ========================================
        // „Éó„É≠„Ç∞„É©„É†ÈñãÂßãÊôÇ„Å´‰∏ÄÂ∫¶„Å†„ÅëÂÆüË°å„Åï„Çå„ÇãÁâπÂà•„Å™Èñ¢Êï∞
        function setup() {
            // „Ç≠„É£„É≥„Éê„ÇπÔºàÊèèÁîªÈ†òÂüüÔºâ„Çí‰ΩúÊàê
            // createCanvas„ÅØp5.js„ÅÆÈñ¢Êï∞„Åß„ÄÅÊåáÂÆö„Çµ„Ç§„Ç∫„ÅÆÊèèÁîªÈ†òÂüü„Çí‰Ωú„Çã
            canvas = createCanvas(CANVAS_WIDTH, CANVAS_HEIGHT);

            // „Ç≠„É£„É≥„Éê„Çπ„ÇíHTMLÂÜÖ„ÅÆÁâπÂÆö„ÅÆË¶ÅÁ¥†„Å´ÈÖçÁΩÆ
            // 'canvasContainer'„Å®„ÅÑ„ÅÜID„ÇíÊåÅ„Å§divË¶ÅÁ¥†„ÅÆ‰∏≠„Å´ÂÖ•„Çå„Çã
            canvas.parent('canvasContainer');

            // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆÂàùÊúüÂåñÔºà„Ç®„Éº„Ç∏„Çß„É≥„Éà„Çí‰ΩúÊàê„Å™„Å©Ôºâ
            initializeSimulation();

            // „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
            // „É¶„Éº„Ç∂„Éº„Åå„Çπ„É©„Ç§„ÉÄ„Éº„ÇíÂãï„Åã„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ„ÇíÁôªÈå≤
            setupSliderListeners();

            // „Ç∞„É©„Éï„ÅÆÂàùÊúüÂåñÔºàPlotly.js„Çí‰ΩøÁî®Ôºâ
            initializeCharts();
        }
        
        // ========================================
        // draw: p5.js„ÅÆ„É°„Ç§„É≥„É´„Éº„ÉóÈñ¢Êï∞
        // ========================================
        // ÊØéÁßíÁ¥Ñ60ÂõûËá™ÂãïÁöÑ„Å´Âëº„Å∞„Çå„ÄÅ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çí‰ΩúÊàê
        function draw() {
            // ========== ËÉåÊôØ„ÅÆ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ÊèèÁîª ==========
            // ‰∏ä„Åã„Çâ‰∏ã„Å´Âêë„Åã„Å£„Å¶Ëâ≤„ÅåÂ§âÂåñ„Åô„ÇãÁæé„Åó„ÅÑËÉåÊôØ„Çí‰ΩúÊàê
            for(let i = 0; i <= CANVAS_HEIGHT; i++) {
                // mapÈñ¢Êï∞ÔºöÂÄ§„ÇíÂà•„ÅÆÁØÑÂõ≤„Å´Â§âÊèõ
                // iÔºà0„ÄúCANVAS_HEIGHTÔºâ„Çí0„Äú1„ÅÆÁØÑÂõ≤„Å´Â§âÊèõ
                let inter = map(i, 0, CANVAS_HEIGHT, 0, 1);

                // lerpColorÔºö2„Å§„ÅÆËâ≤„ÅÆÈñì„ÇíË£úÈñìÔºà„Éñ„É¨„É≥„ÉâÔºâ
                // ËñÑ„ÅÑÈùí(240,248,255)„Åã„ÇâÁôΩ(255,255,255)„Å∏Âæê„ÄÖ„Å´Â§âÂåñ
                let c = lerpColor(color(240, 248, 255), color(255, 255, 255), inter);

                // Ê®™Á∑ö„ÇíÂºï„ÅÑ„Å¶ËÉåÊôØ„ÇíÂ°ó„Çã
                stroke(c);                    // Á∑ö„ÅÆËâ≤„ÇíË®≠ÂÆö
                line(0, i, CANVAS_WIDTH, i);  // Â∑¶Á´Ø„Åã„ÇâÂè≥Á´Ø„Åæ„ÅßÊ®™Á∑ö
            }

            // ========== „Ç∞„É™„ÉÉ„ÉâÔºàÊ†ºÂ≠êÔºâ„ÅÆÊèèÁîª ==========
            // „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆ‰ΩçÁΩÆ„ÇíÊääÊè°„Åó„ÇÑ„Åô„Åè„Åô„Çã„Åü„ÇÅ„ÅÆË£úÂä©Á∑ö
            stroke(200, 50);      // „Ç∞„É¨„ÉºËâ≤„ÄÅÈÄèÊòéÂ∫¶50
            strokeWeight(0.5);    // Á¥∞„ÅÑÁ∑ö

            // Á∏¶Á∑ö„Çí50„Éî„ÇØ„Çª„É´„Åî„Å®„Å´ÊèèÁîª
            for(let x = 0; x < CANVAS_WIDTH; x += 50) {
                line(x, 0, x, CANVAS_HEIGHT);
            }

            // Ê®™Á∑ö„Çí50„Éî„ÇØ„Çª„É´„Åî„Å®„Å´ÊèèÁîª
            for(let y = 0; y < CANVAS_HEIGHT; y += 50) {
                line(0, y, CANVAS_WIDTH, y);
            }
            
            // ========== „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÂÆüË°åÂá¶ÁêÜ ==========
            if (isRunning) {  // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅåÂÆüË°å‰∏≠„ÅÆÂ†¥Âêà„ÅÆ„Åø

                // ========== UI„Åã„Çâ„Éë„É©„É°„Éº„Çø„ÇíÂèñÂæó ==========
                // HTML„ÅÆ„Çπ„É©„Ç§„ÉÄ„Éº„Åã„ÇâÁèæÂú®„ÅÆÂÄ§„ÇíË™≠„ÅøÂèñ„Çã
                // parseFloatÔºöÊñáÂ≠óÂàó„ÇíÂ∞èÊï∞„Å´Â§âÊèõ
                let techPU = parseFloat(document.getElementById('usefulness').value);
                let techPEOU = parseFloat(document.getElementById('easeOfUse').value);
                let socialInf = parseFloat(document.getElementById('socialInfluence').value);

                // ========== „Åô„Åπ„Å¶„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÊõ¥Êñ∞ ==========
                // forEachÔºöÈÖçÂàó„ÅÆÂêÑË¶ÅÁ¥†„Å´ÂØæ„Åó„Å¶Âá¶ÁêÜ„ÇíÂÆüË°å
                agents.forEach(agent => {
                    // ÂêÑ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞ÔºàÁßªÂãï„Å®ÊÑèÊÄùÊ±∫ÂÆöÔºâ
                    agent.update(techPU, techPEOU, socialInf);
                });

                // ÊôÇÈñì„Çí1„Çπ„ÉÜ„ÉÉ„ÉóÈÄ≤„ÇÅ„Çã
                time++;

                // ========== ÂÆöÊúüÁöÑ„Å™Áµ±Ë®àÊõ¥Êñ∞ ==========
                // %Ôºà„É¢„Ç∏„É•„É≠ÔºâÊºîÁÆóÂ≠êÔºö‰Ωô„Çä„ÇíË®àÁÆó
                // time % 5 === 0 „ÅØ„Äå5„Çπ„ÉÜ„ÉÉ„Éó„Åî„Å®„Äç„ÇíÊÑèÂë≥
                if (time % 5 === 0) {
                    updateStatistics();  // Áµ±Ë®àÊÉÖÂ†±„ÇíÊõ¥Êñ∞
                    updateCharts();      // „Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
                }
            }
            
            // ========== „Åô„Åπ„Å¶„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÊèèÁîª ==========
            // ÂÆüË°å‰∏≠„Åß„Å™„Åè„Å¶„ÇÇÊèèÁîª„ÅØË°å„ÅÜÔºà‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠„ÇÇË°®Á§∫Ôºâ
            agents.forEach(agent => {
                agent.display();
            });

            // ========== ÁµåÈÅéÊôÇÈñì„ÇíUI„Å´Ë°®Á§∫ ==========
            // HTML„ÅÆË¶ÅÁ¥†„Å´ÁèæÂú®„ÅÆÊôÇÈñì„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
            document.getElementById('timeStep').textContent = time;
        }
        
        // ========================================
        // initializeSimulation: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂàùÊúüÂåñ
        // ========================================
        // „É™„Çª„ÉÉ„ÉàÊôÇ„ÇÑÊúÄÂàù„ÅÆËµ∑ÂãïÊôÇ„Å´Âëº„Å∞„Çå„Çã
        function initializeSimulation() {
            // ========== Â§âÊï∞„Çí„É™„Çª„ÉÉ„Éà ==========
            agents = [];           // „Ç®„Éº„Ç∏„Çß„É≥„ÉàÈÖçÂàó„ÇíÁ©∫„Å´„Åô„Çã
            time = 0;             // ÊôÇÈñì„Çí0„Å´Êàª„Åô
            adoptionHistory = []; // Â±•Ê≠¥„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢

            // ========== „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÁîüÊàê ==========
            for(let i = 0; i < NUM_AGENTS; i++) {
                // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„ÇíÊ±∫ÂÆö
                // random(min, max)Ôºömin‰ª•‰∏ämaxÊú™Ê∫Ä„ÅÆ„É©„É≥„ÉÄ„É†ÂÄ§
                // Á´Ø„Åã„Çâ20„Éî„ÇØ„Çª„É´ÂÜÖÂÅ¥„Å´ÈÖçÁΩÆÔºàÁ´Ø„Å´Ë°å„Åç„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                let x = random(20, CANVAS_WIDTH - 20);
                let y = random(20, CANVAS_HEIGHT - 20);

                // Êñ∞„Åó„ÅÑ„Ç®„Éº„Ç∏„Çß„É≥„Éà„Çí‰ΩúÊàê„Åó„Å¶ÈÖçÂàó„Å´ËøΩÂä†
                // pushÔºöÈÖçÂàó„ÅÆÊúÄÂæå„Å´Ë¶ÅÁ¥†„ÇíËøΩÂä†
                agents.push(new Agent(x, y, i));
            }

            // ========== „Ç§„Éé„Éô„Éº„Çø„ÉºÔºàÂàùÊúüÊé°Áî®ËÄÖÔºâ„ÅÆË®≠ÂÆö ==========
            // RogersÁêÜË´ñÔºöÊúÄÂàù„Åã„ÇâÊäÄË°ì„ÇíÊé°Áî®„Åó„Å¶„ÅÑ„ÇãÂÖàÈßÜËÄÖ„Åü„Å°

            // „Çπ„É©„Ç§„ÉÄ„Éº„ÅßË®≠ÂÆö„Åï„Çå„ÅüÂâ≤Âêà„Åã„Çâ„Ç§„Éé„Éô„Éº„Çø„ÉºÊï∞„ÇíË®àÁÆó
            // Math.floorÔºöÂ∞èÊï∞ÁÇπ‰ª•‰∏ã„ÇíÂàá„ÇäÊç®„Å¶
            let innovatorCount = Math.floor(NUM_AGENTS * parseFloat(document.getElementById('innovators').value) / 100);

            // ÊúÄÂàù„ÅÆN‰∫∫„Çí„Ç§„Éé„Éô„Éº„Çø„Éº„Å®„Åó„Å¶Ë®≠ÂÆö
            for(let i = 0; i < innovatorCount; i++) {
                agents[i].state = 2;           // ÊúÄÂàù„Åã„ÇâÊé°Áî®Áä∂ÊÖã
                agents[i].innovativeness = 95; // È´ò„ÅÑÈù©Êñ∞ÊÄß„ÇíÊåÅ„Å§
            }

            // ÂàùÊúüÁä∂ÊÖã„ÅÆÁµ±Ë®à„ÇíË®àÁÆó
            updateStatistics();
        }
        
        // ========================================
        // updateStatistics: Áµ±Ë®àÊÉÖÂ†±„ÇíÊõ¥Êñ∞
        // ========================================
        // ÁèæÂú®„ÅÆÂêÑÁä∂ÊÖã„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„ÉàÊï∞„ÇíÈõÜË®à„Åó„Å¶UI„Å´Ë°®Á§∫
        function updateStatistics() {
            // ========== ÂêÑÁä∂ÊÖã„ÅÆ„Ç®„Éº„Ç∏„Çß„É≥„ÉàÊï∞„Çí„Ç´„Ç¶„É≥„Éà ==========
            // filterÔºöÊù°‰ª∂„Å´Âêà„ÅÜË¶ÅÁ¥†„Å†„Åë„ÇíÊäΩÂá∫
            // lengthÔºöÈÖçÂàó„ÅÆË¶ÅÁ¥†Êï∞„ÇíÂèñÂæó

            // Êé°Áî®ËÄÖÔºàstate === 2Ôºâ„ÅÆÊï∞
            let adopters = agents.filter(a => a.state === 2).length;

            // Ê§úË®é‰∏≠Ôºàstate === 1Ôºâ„ÅÆÊï∞
            let considering = agents.filter(a => a.state === 1).length;

            // ÊãíÂê¶ËÄÖÔºàstate === 3Ôºâ„ÅÆÊï∞
            let rejected = agents.filter(a => a.state === 3).length;

            // ========== UI„Å´Ë°®Á§∫ ==========
            // Êé°Áî®ËÄÖÊï∞„Å®Ââ≤Âêà
            document.getElementById('adopters').textContent = adopters;
            // toFixed(1)ÔºöÂ∞èÊï∞Á¨¨1‰Ωç„Åæ„ÅßË°®Á§∫Ôºà‰æãÔºö45.3%Ôºâ
            document.getElementById('adoptersPercent').textContent =
                `${(adopters / NUM_AGENTS * 100).toFixed(1)}%`;

            // Ê§úË®é‰∏≠„ÅÆÊï∞„Å®Ââ≤Âêà
            document.getElementById('considering').textContent = considering;
            document.getElementById('consideringPercent').textContent =
                `${(considering / NUM_AGENTS * 100).toFixed(1)}%`;

            // ========== Â±•Ê≠¥„Éá„Éº„Çø„ÅÆË®òÈå≤ ==========
            // „Ç∞„É©„ÉïÊèèÁîªÁî®„Å´ÊôÇÁ≥ªÂàó„Éá„Éº„Çø„Çí‰øùÂ≠ò
            adoptionHistory.push({
                time: time,                    // ÁèæÂú®„ÅÆÊôÇÂàª
                adopters: adopters,           // Êé°Áî®ËÄÖÊï∞
                considering: considering,     // Ê§úË®é‰∏≠„ÅÆÊï∞
                rejected: rejected,           // ÊãíÂê¶ËÄÖÊï∞
                // Êú™Ë™çÁü•ËÄÖÊï∞„ÅØÂÖ®‰Ωì„Åã„Çâ‰ªñ„ÇíÂºï„ÅÑ„Å¶Ë®àÁÆó
                unaware: NUM_AGENTS - adopters - considering - rejected
            });
        }
        
        // ========================================
        // setupSliderListeners: „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Ç§„Éô„É≥„ÉàÂá¶ÁêÜ„ÇíË®≠ÂÆö
        // ========================================
        // „É¶„Éº„Ç∂„Éº„Åå„Çπ„É©„Ç§„ÉÄ„Éº„ÇíÂãï„Åã„Åó„Åü„Å®„Åç„Å´ÂÄ§„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
        function setupSliderListeners() {
            // addEventListenerÔºö„Ç§„Éô„É≥„Éà„ÅåÁô∫Áîü„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ„ÇíÁôªÈå≤
            // 'input'„Ç§„Éô„É≥„ÉàÔºö„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§„ÅåÂ§â„Çè„Çã„Åü„Å≥„Å´Áô∫Áîü

            // ========== ÊäÄË°ì„ÅÆÊúâÁî®ÊÄß„Çπ„É©„Ç§„ÉÄ„Éº ==========
            document.getElementById('usefulness').addEventListener('input', function(e) {
                // e.target.valueÔºö„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÁèæÂú®„ÅÆÂÄ§
                // „Åù„Çå„ÇíË°®Á§∫Áî®„ÅÆË¶ÅÁ¥†„Å´ÂèçÊò†
                document.getElementById('usefulnessValue').textContent = e.target.value;
            });

            // ========== ÊäÄË°ì„ÅÆ‰Ωø„ÅÑ„ÇÑ„Åô„Åï„Çπ„É©„Ç§„ÉÄ„Éº ==========
            document.getElementById('easeOfUse').addEventListener('input', function(e) {
                document.getElementById('easeOfUseValue').textContent = e.target.value;
            });

            // ========== Á§æ‰ºöÁöÑÂΩ±ÈüøÂäõ„Çπ„É©„Ç§„ÉÄ„Éº ==========
            document.getElementById('socialInfluence').addEventListener('input', function(e) {
                document.getElementById('socialInfluenceValue').textContent = e.target.value;
            });

            // ========== „Ç§„Éé„Éô„Éº„Çø„ÉºÊØîÁéá„Çπ„É©„Ç§„ÉÄ„Éº ==========
            document.getElementById('innovators').addEventListener('input', function(e) {
                // %Ë®òÂè∑„ÇíËøΩÂä†„Åó„Å¶Ë°®Á§∫
                document.getElementById('innovatorsValue').textContent = e.target.value + '%';
            });
        }
        
        // ========================================
        // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Âà∂Âæ°Èñ¢Êï∞
        // ========================================

        // startSimulation: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÈñãÂßã
        // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„ÅßÂëº„Å∞„Çå„Çã
        function startSimulation() {
            isRunning = true;  // „Éï„É©„Ç∞„Çítrue„Å´„Åó„Å¶„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÂÆüË°å
        }

        // pauseSimulation: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí‰∏ÄÊôÇÂÅúÊ≠¢
        // ÂÆüË°å„ÇíÊ≠¢„ÇÅ„Çã„Åå„ÄÅÁèæÂú®„ÅÆÁä∂ÊÖã„ÅØ‰øùÊåÅ
        function pauseSimulation() {
            isRunning = false; // „Éï„É©„Ç∞„Çífalse„Å´„Åó„Å¶ÂÅúÊ≠¢
        }

        // resetSimulation: „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí„É™„Çª„ÉÉ„Éà
        // „Åô„Åπ„Å¶„ÇíÂàùÊúüÁä∂ÊÖã„Å´Êàª„Åô
        function resetSimulation() {
            isRunning = false;           // „Åæ„ÅöÂÅúÊ≠¢
            initializeSimulation();      // „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÇíÂÜçÁîüÊàê
            initializeCharts();          // „Ç∞„É©„Éï„ÇÇ„É™„Çª„ÉÉ„Éà
        }
        
        // ========================================
        // initializeCharts: „Ç∞„É©„Éï„ÇíÂàùÊúüÂåñÔºàPlotly.js‰ΩøÁî®Ôºâ
        // ========================================
        // 2„Å§„ÅÆ„Ç∞„É©„ÉïÔºàÊôÇÁ≥ªÂàó„Å®ÂÜÜ„Ç∞„É©„ÉïÔºâ„ÇíÊ∫ñÂÇô
        function initializeCharts() {
            // ========== Êé°Áî®ÁéáÊé®Áßª„ÉÅ„É£„Éº„ÉàÔºàÊäò„ÇåÁ∑ö„Ç∞„É©„ÉïÔºâ==========

            // trace1: Êé°Áî®ËÄÖÊï∞„ÅÆÊé®Áßª„ÇíË°®„Åô„Éá„Éº„Çø
            let trace1 = {
                x: [0],                      // XËª∏„Éá„Éº„ÇøÔºàÊôÇÈñìÔºâ„ÄÅÂàùÊúüÂÄ§0
                y: [0],                      // YËª∏„Éá„Éº„ÇøÔºàÊé°Áî®ËÄÖÊï∞Ôºâ„ÄÅÂàùÊúüÂÄ§0
                type: 'scatter',             // Êï£Â∏ÉÂõ≥„Çø„Ç§„ÉóÔºàÁ∑ö„Åß„Å§„Å™„ÅêÔºâ
                mode: 'lines',               // Á∑ö„ÅÆ„ÅøË°®Á§∫ÔºàÁÇπ„ÅØË°®Á§∫„Åó„Å™„ÅÑÔºâ
                name: 'Êé°Áî®ËÄÖ',              // Âá°‰æã„Å´Ë°®Á§∫„Åï„Çå„ÇãÂêçÂâç
                line: {color: '#4169E1', width: 3}  // ÈùíËâ≤„ÄÅÁ∑ö„ÅÆÂ§™„Åï3
            };
            
            let trace2 = {
                x: [0],
                y: [0],
                type: 'scatter',
                mode: 'lines',
                name: 'Ê§úË®é‰∏≠',
                line: {color: '#FFD700', width: 2}
            };
            
            let layout1 = {
                height: 250,
                margin: {t: 20, r: 20, b: 40, l: 50},
                xaxis: {title: 'ÊôÇÈñì'},
                yaxis: {title: '„Ç®„Éº„Ç∏„Çß„É≥„ÉàÊï∞'},
                showlegend: true,
                legend: {x: 0, y: 1}
            };
            
            Plotly.newPlot('adoptionChart', [trace1, trace2], layout1, {displayModeBar: false});
            
            // ========== ÂàÜÂ∏É„ÉÅ„É£„Éº„ÉàÔºàÂÜÜ„Ç∞„É©„ÉïÔºâ==========

            // trace3: „Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆÁä∂ÊÖãÂàÜÂ∏É„ÇíË°®„ÅôÂÜÜ„Ç∞„É©„Éï
            let trace3 = {
                values: [NUM_AGENTS, 0, 0, 0],  // ÂàùÊúüÂÄ§ÔºöÂÖ®Âì°„ÅåÊú™Ë™çÁü•
                labels: ['Êú™Ë™çÁü•', 'Ê§úË®é‰∏≠', 'Êé°Áî®', 'ÊãíÂê¶'],  // ÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„É©„Éô„É´
                type: 'pie',                    // ÂÜÜ„Ç∞„É©„Éï
                marker: {
                    // ÂêÑÁä∂ÊÖã„ÅÆËâ≤Ôºà„Ç®„Éº„Ç∏„Çß„É≥„ÉàË°®Á§∫„Å®Âêå„ÅòËâ≤„Çí‰ΩøÁî®Ôºâ
                    colors: ['#D3D3D3', '#FFD700', '#4169E1', '#FF6B6B']
                    //        „Ç∞„É¨„Éº     ÈªÑËâ≤       Èùí        Ëµ§
                }
            };
            
            let layout2 = {
                height: 250,
                margin: {t: 20, r: 20, b: 20, l: 20}
            };
            
            Plotly.newPlot('distributionChart', [trace3], layout2, {displayModeBar: false});
        }
        
        // ========================================
        // updateCharts: „Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
        // ========================================
        // ÊúÄÊñ∞„ÅÆÁµ±Ë®à„Éá„Éº„Çø„Åß„Ç∞„É©„Éï„ÇíÂÜçÊèèÁîª
        function updateCharts() {
            // Â±•Ê≠¥„Éá„Éº„Çø„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøÊõ¥Êñ∞
            if (adoptionHistory.length > 0) {
                // ÊúÄÊñ∞„ÅÆ„Éá„Éº„Çø„Éù„Ç§„É≥„Éà„ÇíÂèñÂæó
                // length - 1ÔºöÈÖçÂàó„ÅÆÊúÄÂæå„ÅÆË¶ÅÁ¥†„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
                let latest = adoptionHistory[adoptionHistory.length - 1];

                // ========== ÊôÇÁ≥ªÂàó„Ç∞„É©„Éï„ÅÆÊõ¥Êñ∞ ==========

                // mapÈñ¢Êï∞ÔºöÈÖçÂàó„ÅÆÂêÑË¶ÅÁ¥†„ÇíÂ§âÊèõ„Åó„Å¶Êñ∞„Åó„ÅÑÈÖçÂàó„Çí‰ΩúÊàê
                // Â±•Ê≠¥„Åã„ÇâÊôÇÈñì„ÅÆÈÖçÂàó„Çí‰ΩúÊàê
                let times = adoptionHistory.map(h => h.time);

                // Â±•Ê≠¥„Åã„ÇâÊé°Áî®ËÄÖÊï∞„ÅÆÈÖçÂàó„Çí‰ΩúÊàê
                let adopters = adoptionHistory.map(h => h.adopters);

                // Â±•Ê≠¥„Åã„ÇâÊ§úË®é‰∏≠Êï∞„ÅÆÈÖçÂàó„Çí‰ΩúÊàê
                let considering = adoptionHistory.map(h => h.considering);

                // Plotly.updateÔºöÊó¢Â≠ò„ÅÆ„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞ÔºàÂÜçÊèèÁîª„Çà„ÇäÈ´òÈÄüÔºâ
                // ÂºïÊï∞Ôºö(„Ç∞„É©„ÉïID, Êñ∞„Éá„Éº„Çø, „É¨„Ç§„Ç¢„Ç¶„ÉàÂ§âÊõ¥, „Éà„É¨„Éº„ÇπÁï™Âè∑)
                Plotly.update('adoptionChart', {
                    x: [times, times],           // ‰∏°Êñπ„ÅÆ„Éà„É¨„Éº„Çπ„Å´Âêå„ÅòXËª∏„Éá„Éº„Çø
                    y: [adopters, considering]   // „Åù„Çå„Åû„Çå„ÅÆYËª∏„Éá„Éº„Çø
                }, {}, [0, 1]);                 // „Éà„É¨„Éº„Çπ0„Å®1„ÇíÊõ¥Êñ∞

                // ========== ÂÜÜ„Ç∞„É©„Éï„ÅÆÊõ¥Êñ∞ ==========

                // ÊúÄÊñ∞„ÅÆÁä∂ÊÖãÂàÜÂ∏É„ÅßÂÜÜ„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
                Plotly.update('distributionChart', {
                    // ‰∫åÈáçÈÖçÂàó„Å´„Åô„ÇãÁêÜÁî±ÔºöPlotly„ÅÆ‰ªïÊßò
                    values: [[latest.unaware, latest.considering, latest.adopters, latest.rejected]]
                }, {}, [0]);  // „Éà„É¨„Éº„Çπ0ÔºàÂîØ‰∏Ä„ÅÆ„Éà„É¨„Éº„ÇπÔºâ„ÇíÊõ¥Êñ∞
            }
        }
    </script>
</body>
</html>