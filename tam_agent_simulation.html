<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAMãƒ™ãƒ¼ã‚¹ã®æŠ€è¡“æ‹¡æ•£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 5px;
            font-size: 28px;
            font-weight: 600;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .simulation-container {
            display: grid;
            grid-template-columns: 800px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        #canvasContainer {
            background: #f7fafc;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        .controls {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 13px;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        .value-display {
            min-width: 45px;
            text-align: center;
            padding: 4px 8px;
            background: #edf2f7;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #2d3748;
        }
        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        .stat-label {
            font-size: 11px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }
        .stat-percentage {
            font-size: 12px;
            color: #48bb78;
            margin-left: 5px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        .chart {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }
        .legend {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .legend-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .model-description {
            background: #fef5e7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #f39c12;
        }
        .model-description h3 {
            color: #2d3748;
            margin-top: 0;
            font-size: 16px;
        }
        .model-description ul {
            margin: 10px 0;
            padding-left: 20px;
            line-height: 1.6;
            font-size: 13px;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ TAMãƒ™ãƒ¼ã‚¹æŠ€è¡“æ‹¡æ•£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«</h1>
        <p class="subtitle">Technology Acceptance Model Ã— Agent-Based Simulation</p>
        
        <div class="simulation-container">
            <div id="canvasContainer"></div>
            
            <div class="controls">
                <h3 style="margin-top: 0; color: #2d3748; font-size: 16px;">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡</h3>
                
                <div class="control-group">
                    <label>æŠ€è¡“ã®æœ‰ç”¨æ€§ (Perceived Usefulness)</label>
                    <div class="slider-container">
                        <input type="range" id="usefulness" min="0" max="100" value="60">
                        <span class="value-display" id="usefulnessValue">60</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>æŠ€è¡“ã®ä½¿ã„ã‚„ã™ã• (Perceived Ease of Use)</label>
                    <div class="slider-container">
                        <input type="range" id="easeOfUse" min="0" max="100" value="50">
                        <span class="value-display" id="easeOfUseValue">50</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ç¤¾ä¼šçš„å½±éŸ¿åŠ› (Social Influence)</label>
                    <div class="slider-container">
                        <input type="range" id="socialInfluence" min="0" max="100" value="30">
                        <span class="value-display" id="socialInfluenceValue">30</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼æ¯”ç‡ (%)</label>
                    <div class="slider-container">
                        <input type="range" id="innovators" min="1" max="20" value="5">
                        <span class="value-display" id="innovatorsValue">5%</span>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="startSimulation()">é–‹å§‹</button>
                    <button class="btn-secondary" onclick="pauseSimulation()">ä¸€æ™‚åœæ­¢</button>
                    <button class="btn-secondary" onclick="resetSimulation()">ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">æ¡ç”¨è€…æ•°</div>
                        <div class="stat-value">
                            <span id="adopters">0</span>
                            <span class="stat-percentage" id="adoptersPercent">0%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ¤œè¨ä¸­</div>
                        <div class="stat-value">
                            <span id="considering">0</span>
                            <span class="stat-percentage" id="consideringPercent">0%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ™‚é–“çµŒé</div>
                        <div class="stat-value" id="timeStep">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-title">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçŠ¶æ…‹</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #90EE90;"></div>
                    <span>ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ï¼ˆåˆæœŸæ¡ç”¨è€…ï¼‰</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4169E1;"></div>
                    <span>æ¡ç”¨è€…</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFD700;"></div>
                    <span>æ¤œè¨ä¸­</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #D3D3D3;"></div>
                    <span>æœªèªçŸ¥</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF6B6B;"></div>
                    <span>æ‹’å¦è€…</span>
                </div>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart">
                <div class="chart-title">ğŸ“ˆ æ¡ç”¨ç‡ã®æ¨ç§»</div>
                <div id="adoptionChart"></div>
            </div>
            <div class="chart">
                <div class="chart-title">ğŸ“Š ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ†å¸ƒ</div>
                <div id="distributionChart"></div>
            </div>
        </div>
        
        <div class="model-description">
            <h3>ãƒ¢ãƒ‡ãƒ«ã®èª¬æ˜</h3>
            <ul>
                <li><strong>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¡Œå‹•</strong>ï¼šå„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯å€‹åˆ¥ã®PUï¼ˆæœ‰ç”¨æ€§ï¼‰ã¨PEOUï¼ˆä½¿ã„ã‚„ã™ã•ï¼‰ã®é–¾å€¤ã‚’æŒã¡ã€æŠ€è¡“è©•ä¾¡ã‚’è¡Œã„ã¾ã™</li>
                <li><strong>ç¤¾ä¼šçš„å½±éŸ¿</strong>ï¼šè¿‘éš£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¡ç”¨çŠ¶æ³ãŒå€‹äººã®æ¡ç”¨æ±ºå®šã«å½±éŸ¿ï¼ˆTAM2ãƒ¢ãƒ‡ãƒ«ã®è¦ç´ ï¼‰</li>
                <li><strong>æ¡ç”¨ãƒ—ãƒ­ã‚»ã‚¹</strong>ï¼šæœªèªçŸ¥â†’æ¤œè¨ä¸­â†’æ¡ç”¨/æ‹’å¦ã®æ®µéšçš„é·ç§»</li>
                <li><strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŠ¹æœ</strong>ï¼šæ¡ç”¨è€…ã®å¢—åŠ ã«ã‚ˆã‚Šã€ä»–è€…ã®çŸ¥è¦šã•ã‚ŒãŸæœ‰ç”¨æ€§ãŒå‘ä¸Š</li>
                <li><strong>å€‹äººå·®</strong>ï¼šé©æ–°æ€§ã€ãƒªã‚¹ã‚¯è¨±å®¹åº¦ã€æŠ€è¡“è¦ªå’Œæ€§ãŒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã”ã¨ã«ç•°ãªã‚‹</li>
            </ul>
        </div>
    </div>

    <script>
        // ========================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®å®šç¾©
        // ========================================

        // agents: ã™ã¹ã¦ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆå€‹äººï¼‰ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
        // å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯æŠ€è¡“ã‚’æ¡ç”¨ã™ã‚‹ã‹ã©ã†ã‹ç‹¬è‡ªã«åˆ¤æ–­ã™ã‚‹å€‹äººã‚’è¡¨ã—ã¾ã™
        let agents = [];

        // time: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµŒéæ™‚é–“ï¼ˆã‚¹ãƒ†ãƒƒãƒ—æ•°ï¼‰
        // 1ã‚¹ãƒ†ãƒƒãƒ—ã¯å®Ÿä¸–ç•Œã®1æ—¥ã‚„1é€±é–“ãªã©ã«ç›¸å½“ã™ã‚‹ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™
        let time = 0;

        // isRunning: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œä¸­ã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹ãƒ•ãƒ©ã‚°
        // true = å®Ÿè¡Œä¸­ã€false = åœæ­¢ä¸­
        let isRunning = false;

        // adoptionHistory: æ¡ç”¨ç‡ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹é…åˆ—
        // ã‚°ãƒ©ãƒ•æç”»ã«ä½¿ç”¨ã•ã‚Œã¾ã™
        let adoptionHistory = [];

        // canvas: p5.jsã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‹•ãã‚’æç”»ã™ã‚‹é ˜åŸŸã§ã™
        let canvas;

        // ========================================
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        // ========================================

        // NUM_AGENTS: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆå€‹äººï¼‰ã®ç·æ•°
        // å¤šã„ã»ã©ç¾å®Ÿçš„ã§ã™ãŒã€å‡¦ç†ãŒé‡ããªã‚Šã¾ã™
        const NUM_AGENTS = 400;

        // CANVAS_WIDTH, CANVAS_HEIGHT: æç”»é ˜åŸŸã®ã‚µã‚¤ã‚ºï¼ˆãƒ”ã‚¯ã‚»ãƒ«å˜ä½ï¼‰
        const CANVAS_WIDTH = 780;
        const CANVAS_HEIGHT = 500;
        
        // ========================================
        // Agentã‚¯ãƒ©ã‚¹ï¼šå€‹ã€…ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆå€‹äººï¼‰ã‚’è¡¨ç¾
        // ========================================
        // å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ç‹¬è‡ªã®æ€§æ ¼ã‚„åˆ¤æ–­åŸºæº–ã‚’æŒã¡ã€
        // å‘¨å›²ã®å½±éŸ¿ã‚’å—ã‘ãªãŒã‚‰æŠ€è¡“æ¡ç”¨ã‚’æ±ºå®šã—ã¾ã™
        class Agent {
            constructor(x, y, id) {
                // ========== åŸºæœ¬å±æ€§ ==========
                // id: ã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å›ºæœ‰è­˜åˆ¥ç•ªå·
                this.id = id;

                // x, y: ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã®ç¾åœ¨ä½ç½®ï¼ˆåº§æ¨™ï¼‰
                this.x = x;
                this.y = y;

                // vx, vy: ç§»å‹•é€Ÿåº¦ï¼ˆvelocityï¼‰ã®xæˆåˆ†ã¨yæˆåˆ†
                // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ©ãƒ³ãƒ€ãƒ ã«å‹•ãå›ã‚‹ãŸã‚ã«ä½¿ç”¨
                this.vx = 0;
                this.vy = 0;

                // ========== TAMãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå€‹äººå·®ã‚’è¡¨ç¾ï¼‰==========

                // puThreshold: Perceived Usefulnessï¼ˆçŸ¥è¦šã•ã‚ŒãŸæœ‰ç”¨æ€§ï¼‰ã®é–¾å€¤
                // ã“ã®å€¤ãŒä½ã„äººã»ã©ã€å°‘ã—ã®æœ‰ç”¨æ€§ã§ã‚‚æŠ€è¡“ã‚’æ¡ç”¨ã—ã‚„ã™ã„
                // random(20, 80)ã§20ã€œ80ã®é–“ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’è¨­å®š
                this.puThreshold = random(20, 80);

                // peouThreshold: Perceived Ease of Useï¼ˆçŸ¥è¦šã•ã‚ŒãŸä½¿ã„ã‚„ã™ã•ï¼‰ã®é–¾å€¤
                // ã“ã®å€¤ãŒä½ã„äººã»ã©ã€ä½¿ã„ã«ãã„æŠ€è¡“ã§ã‚‚å—ã‘å…¥ã‚Œã‚„ã™ã„
                this.peouThreshold = random(20, 80);

                // innovativeness: é©æ–°æ€§ï¼ˆã‚¤ãƒãƒ™ãƒ¼ãƒ†ã‚£ãƒ–ã•ï¼‰
                // 0ã€œ100ã®å€¤ã§ã€é«˜ã„ã»ã©æ–°ã—ã„æŠ€è¡“ã«ç©æ¥µçš„
                // Rogersç†è«–ã®ã€Œã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ã€ã€Œã‚¢ãƒ¼ãƒªãƒ¼ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã€ãªã©ã«ç›¸å½“
                this.innovativeness = random(0, 100);

                // ========== ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ç®¡ç† ==========

                // state: ç¾åœ¨ã®æ¡ç”¨çŠ¶æ…‹ã‚’è¡¨ã™æ•°å€¤
                // 0 = æœªèªçŸ¥ï¼ˆæŠ€è¡“ã®å­˜åœ¨ã‚’çŸ¥ã‚‰ãªã„ï¼‰
                // 1 = æ¤œè¨ä¸­ï¼ˆæŠ€è¡“ã‚’çŸ¥ã£ã¦è©•ä¾¡ã—ã¦ã„ã‚‹ï¼‰
                // 2 = æ¡ç”¨ï¼ˆæŠ€è¡“ã‚’ä½¿ã„å§‹ã‚ãŸï¼‰
                // 3 = æ‹’å¦ï¼ˆæ¤œè¨ã®çµæœã€ä½¿ã‚ãªã„ã“ã¨ã«æ±ºã‚ãŸï¼‰
                this.state = 0;

                // considerationTime: æ¤œè¨ã‚’å§‹ã‚ã¦ã‹ã‚‰ã®çµŒéæ™‚é–“
                // äººã¯å³åº§ã«æ±ºå®šã›ãšã€æ™‚é–“ã‚’ã‹ã‘ã¦æ¤œè¨ã—ã¾ã™
                this.considerationTime = 0;

                // maxConsiderationTime: æ¤œè¨ã«ã‹ã‘ã‚‹æœ€å¤§æ™‚é–“
                // ã“ã®æ™‚é–“ãŒçµŒéã—ãŸã‚‰æ¡ç”¨ã‹æ‹’å¦ã‹ã‚’æ±ºå®š
                // 10ã€œ50ã‚¹ãƒ†ãƒƒãƒ—ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ ã«è¨­å®šï¼ˆå€‹äººå·®ï¼‰
                this.maxConsiderationTime = random(10, 50);

                // ========== ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ==========

                // neighbors: è¿‘ãã«ã„ã‚‹ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆ
                // ç¤¾ä¼šçš„å½±éŸ¿ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨
                this.neighbors = [];

                // influenceRadius: å½±éŸ¿ã‚’ä¸ãˆã‚‹/å—ã‘ã‚‹ç¯„å›²ï¼ˆåŠå¾„ï¼‰
                // ã“ã®ç¯„å›²å†…ã«ã„ã‚‹ä»–è€…ã‹ã‚‰ç¤¾ä¼šçš„å½±éŸ¿ã‚’å—ã‘ã¾ã™
                this.influenceRadius = 50;
            }
            
            // ========================================
            // update: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ãƒ¡ã‚¤ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰
            // ========================================
            // æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç§»å‹•ã¨æ„æ€æ±ºå®šã‚’å‡¦ç†ã—ã¾ã™
            update(techPU, techPEOU, socialInfluence) {
                // techPU: æŠ€è¡“ã®æœ‰ç”¨æ€§ï¼ˆ0-100ï¼‰
                // techPEOU: æŠ€è¡“ã®ä½¿ã„ã‚„ã™ã•ï¼ˆ0-100ï¼‰
                // socialInfluence: ç¤¾ä¼šçš„å½±éŸ¿ã®å¼·ã•ï¼ˆ0-100ï¼‰

                // ========== 1. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç§»å‹•å‡¦ç† ==========
                // ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ï¼šç¾å®Ÿä¸–ç•Œã§ã®äººã®ç§»å‹•ã‚’æ¨¡æ“¬

                // é€Ÿåº¦ã«ãƒ©ãƒ³ãƒ€ãƒ ãªåŠ é€Ÿåº¦ã‚’è¿½åŠ ï¼ˆ-0.5ã€œ0.5ã®ç¯„å›²ï¼‰
                // ã“ã‚Œã«ã‚ˆã‚Šäºˆæ¸¬ä¸å¯èƒ½ãªè‡ªç„¶ãªå‹•ãã‚’å®Ÿç¾
                this.vx += random(-0.5, 0.5);
                this.vy += random(-0.5, 0.5);

                // é€Ÿåº¦ã«æ¸›è¡°ã‚’ã‹ã‘ã‚‹ï¼ˆ0.95ã‚’æ›ã‘ã‚‹ï¼‰
                // ã“ã‚ŒãŒãªã„ã¨ç„¡é™ã«åŠ é€Ÿã—ã¦ã—ã¾ã†ãŸã‚
                this.vx *= 0.95;
                this.vy *= 0.95;

                // é€Ÿåº¦ã‚’ä½ç½®ã«åæ˜ ï¼ˆå®Ÿéš›ã®ç§»å‹•ï¼‰
                this.x += this.vx;
                this.y += this.vy;

                // ========== 2. å¢ƒç•Œå‡¦ç†ï¼ˆå£ã®å®Ÿè£…ï¼‰==========
                // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚­ãƒ£ãƒ³ãƒã‚¹ã®å¤–ã«å‡ºãªã„ã‚ˆã†ã«åˆ¶é™
                if (this.x < 10) this.x = 10;                           // å·¦ç«¯
                if (this.x > CANVAS_WIDTH - 10) this.x = CANVAS_WIDTH - 10;  // å³ç«¯
                if (this.y < 10) this.y = 10;                           // ä¸Šç«¯
                if (this.y > CANVAS_HEIGHT - 10) this.y = CANVAS_HEIGHT - 10; // ä¸‹ç«¯

                // ========== 3. ç¤¾ä¼šçš„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ›´æ–° ==========
                // è¿‘ãã«ã„ã‚‹ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ¤œå‡º
                this.findNeighbors();

                // ========== 4. çŠ¶æ…‹é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ„æ€æ±ºå®šã®ä¸­æ ¸ï¼‰==========

                if (this.state === 0) { // ã€æœªèªçŸ¥çŠ¶æ…‹ã€‘ã®å‡¦ç†
                    // ã¾ã æŠ€è¡“ã®å­˜åœ¨ã‚’çŸ¥ã‚‰ãªã„çŠ¶æ…‹

                    // è¿‘éš£ã®æ¡ç”¨è€…æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
                    // filter: æ¡ä»¶ã«åˆã†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã ã‘ã‚’æŠ½å‡º
                    // a.state === 2: æ¡ç”¨æ¸ˆã¿ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
                    let adoptedNeighbors = this.neighbors.filter(a => a.state === 2).length;

                    // èªçŸ¥ã®ãã£ã‹ã‘ï¼š
                    // 1. è¿‘ãã«æ¡ç”¨è€…ãŒã„ã‚‹ï¼ˆå£ã‚³ãƒŸåŠ¹æœï¼‰
                    // 2. ã¾ãŸã¯ãƒ©ãƒ³ãƒ€ãƒ ã«èªçŸ¥ï¼ˆåºƒå‘Šãªã©ã‚’æƒ³å®šã€0.5%ã®ç¢ºç‡ï¼‰
                    if (adoptedNeighbors > 0 || random(100) < 0.5) {
                        this.state = 1; // æ¤œè¨ä¸­çŠ¶æ…‹ã¸ç§»è¡Œ
                    }

                } else if (this.state === 1) { // ã€æ¤œè¨ä¸­çŠ¶æ…‹ã€‘ã®å‡¦ç†
                    // æŠ€è¡“ã‚’çŸ¥ã£ã¦ã€æ¡ç”¨ã™ã‚‹ã‹æ¤œè¨ã—ã¦ã„ã‚‹çŠ¶æ…‹

                    // æ¤œè¨æ™‚é–“ã‚’ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
                    this.considerationTime++;

                    // ========== TAMãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ãè©•ä¾¡è¨ˆç®— ==========

                    // åŸºæœ¬çš„ãªçŸ¥è¦šå€¤ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§è¨­å®šã•ã‚ŒãŸå€¤ï¼‰
                    let perceivedPU = techPU;     // çŸ¥è¦šã•ã‚ŒãŸæœ‰ç”¨æ€§
                    let perceivedPEOU = techPEOU; // çŸ¥è¦šã•ã‚ŒãŸä½¿ã„ã‚„ã™ã•

                    // ========== ç¤¾ä¼šçš„å½±éŸ¿ã®è¨ˆç®— ==========
                    // å‘¨å›²ã®æ¡ç”¨è€…ã®å‰²åˆã‹ã‚‰å½±éŸ¿ã‚’å—ã‘ã‚‹

                    // è¿‘éš£ã®æ¡ç”¨è€…æ•°ã‚’å†åº¦ã‚«ã‚¦ãƒ³ãƒˆ
                    let adoptedNeighbors = this.neighbors.filter(a => a.state === 2).length;

                    // æ¡ç”¨è€…ã®å‰²åˆã‚’è¨ˆç®—ï¼ˆ0ã€œ1ã®å€¤ï¼‰
                    // max(this.neighbors.length, 1): ã‚¼ãƒ­é™¤ç®—ã‚’é˜²ã
                    let neighborInfluence = (adoptedNeighbors / max(this.neighbors.length, 1)) * socialInfluence;

                    // ========== ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŠ¹æœã®é©ç”¨ ==========
                    // å‘¨å›²ã«æ¡ç”¨è€…ãŒå¤šã„ã»ã©ã€æŠ€è¡“ãŒã‚ˆã‚Šæœ‰ç”¨ã§ä½¿ã„ã‚„ã™ãæ„Ÿã˜ã‚‹
                    perceivedPU += neighborInfluence * 0.5;   // æœ‰ç”¨æ€§ã¯50%å½±éŸ¿ã‚’å—ã‘ã‚‹
                    perceivedPEOU += neighborInfluence * 0.3; // ä½¿ã„ã‚„ã™ã•ã¯30%å½±éŸ¿ã‚’å—ã‘ã‚‹

                    // ========== æ¡ç”¨æ„å›³ã®è¨ˆç®—ï¼ˆTAMãƒ¢ãƒ‡ãƒ«ã®ä¸­æ ¸ï¼‰==========
                    // æ¡ç”¨æ„å›³ = æœ‰ç”¨æ€§Ã—60% + ä½¿ã„ã‚„ã™ã•Ã—40%
                    // ã•ã‚‰ã«å€‹äººã®é©æ–°æ€§ã§èª¿æ•´ï¼ˆé©æ–°çš„ãªäººã»ã©æ¡ç”¨ã—ã‚„ã™ã„ï¼‰
                    let intention = (perceivedPU * 0.6 + perceivedPEOU * 0.4) * (1 + this.innovativeness / 200);

                    // ========== æœ€çµ‚çš„ãªæ„æ€æ±ºå®š ==========
                    // ååˆ†ãªæ¤œè¨æ™‚é–“ãŒçµŒéã—ãŸã‚‰æ±ºå®šã‚’ä¸‹ã™
                    if (this.considerationTime > this.maxConsiderationTime) {
                        // æ¡ç”¨æ„å›³ãŒå€‹äººã®é–¾å€¤ã‚’è¶…ãˆãŸã‚‰æ¡ç”¨ã€ãã†ã§ãªã‘ã‚Œã°æ‹’å¦
                        if (intention > (this.puThreshold * 0.6 + this.peouThreshold * 0.4)) {
                            this.state = 2; // æ¡ç”¨ï¼
                        } else {
                            this.state = 3; // æ‹’å¦
                        }
                    }
                }
                // æ³¨ï¼šæ¡ç”¨ï¼ˆstate=2ï¼‰ã‚„æ‹’å¦ï¼ˆstate=3ï¼‰ã«ãªã£ãŸã‚‰ã€ãã®çŠ¶æ…‹ã¯å¤‰ã‚ã‚‰ãªã„
            }
            
            // ========================================
            // findNeighbors: è¿‘éš£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ¤œå‡º
            // ========================================
            // ç¤¾ä¼šçš„å½±éŸ¿ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã€å½±éŸ¿ç¯„å›²å†…ã®ä»–è€…ã‚’ç‰¹å®šã—ã¾ã™
            findNeighbors() {
                // filteré–¢æ•°ã§æ¡ä»¶ã«åˆã†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã ã‘ã‚’æŠ½å‡º
                this.neighbors = agents.filter(a => {
                    // è‡ªåˆ†è‡ªèº«ã¯é™¤å¤–ï¼ˆè‡ªåˆ†ã§è‡ªåˆ†ã«å½±éŸ¿ã—ãªã„ï¼‰
                    if (a === this) return false;

                    // disté–¢æ•°ï¼š2ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆp5.jsã®é–¢æ•°ï¼‰
                    // âˆš((x2-x1)Â² + (y2-y1)Â²) ã‚’è¨ˆç®—
                    let d = dist(this.x, this.y, a.x, a.y);

                    // å½±éŸ¿ç¯„å›²å†…ï¼ˆinfluenceRadiusä»¥å†…ï¼‰ã«ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    return d < this.influenceRadius;
                });
            }
            
            // ========================================
            // display: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç”»é¢ã«æç”»
            // ========================================
            // è¦–è¦šçš„ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’è¡¨ç¾ã—ã¾ã™
            display() {
                // push()ã¨pop()ï¼šæç”»è¨­å®šã‚’ä¸€æ™‚çš„ã«ä¿å­˜ãƒ»å¾©å…ƒ
                // ä»–ã®æç”»ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã™ã‚‹
                push();

                // ========== å½±éŸ¿ç¯„å›²ã®å¯è¦–åŒ– ==========
                // æ¡ç”¨è€…ã®ã¿ã€ãã®å½±éŸ¿ç¯„å›²ã‚’è–„ã„é’ã„å††ã§è¡¨ç¤º
                if (this.state === 2) {
                    noStroke();                    // æ ç·šãªã—
                    fill(65, 105, 225, 30);       // é’è‰²ã€é€æ˜åº¦30ï¼ˆè–„ã„é’ï¼‰
                    // ç›´å¾„ã¯å½±éŸ¿åŠå¾„ã®2å€ï¼ˆcircleé–¢æ•°ã¯ç›´å¾„ã‚’æŒ‡å®šï¼‰
                    circle(this.x, this.y, this.influenceRadius * 2);
                }

                // ========== ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæœ¬ä½“ã®æç”»è¨­å®š ==========
                let col;      // è‰²ã‚’æ ¼ç´ã™ã‚‹å¤‰æ•°
                let size = 8; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚º

                // çŠ¶æ…‹ã«å¿œã˜ã¦è‰²ã¨ã‚µã‚¤ã‚ºã‚’æ±ºå®š
                switch(this.state) {
                    case 0: // æœªèªçŸ¥
                        col = color(211, 211, 211);  // ã‚°ãƒ¬ãƒ¼ï¼ˆçŸ¥ã‚‰ãªã„çŠ¶æ…‹ã‚’è¡¨ç¾ï¼‰
                        break;
                    case 1: // æ¤œè¨ä¸­
                        col = color(255, 215, 0);     // é»„è‰²ï¼ˆè€ƒãˆã¦ã„ã‚‹çŠ¶æ…‹ã‚’è¡¨ç¾ï¼‰
                        size = 10;                    // å°‘ã—å¤§ããï¼ˆæ³¨ç›®ã—ã¦ã„ã‚‹ï¼‰
                        break;
                    case 2: // æ¡ç”¨
                        col = color(65, 105, 225);    // é’ï¼ˆæ¡ç”¨æ¸ˆã¿ã‚’è¡¨ç¾ï¼‰
                        size = 12;                    // å¤§ããï¼ˆé‡è¦ãªå­˜åœ¨ï¼‰
                        break;
                    case 3: // æ‹’å¦
                        col = color(255, 107, 107);   // èµ¤ï¼ˆæ‹’å¦ã‚’è¡¨ç¾ï¼‰
                        size = 6;                     // å°ã•ãï¼ˆé–¢å¿ƒã‚’å¤±ã£ãŸï¼‰
                        break;
                }

                // ========== ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ã®ç‰¹åˆ¥è¡¨ç¤º ==========
                // é©æ–°æ€§ãŒ90ä»¥ä¸Šã‹ã¤æ¡ç”¨æ¸ˆã¿ã®äººã¯ã€Œã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ã€ã¨ã—ã¦ç·‘è‰²ã§è¡¨ç¤º
                if (this.innovativeness > 90 && this.state === 2) {
                    col = color(144, 238, 144); // ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³
                    size = 14;                  // æœ€å¤§ã‚µã‚¤ã‚ºï¼ˆå½±éŸ¿åŠ›ãŒå¤§ãã„ï¼‰
                }

                // ========== ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæœ¬ä½“ã‚’æç”» ==========
                stroke(255, 100);      // ç™½ã„æ ç·šï¼ˆé€æ˜åº¦100ï¼‰
                strokeWeight(2);       // æ ç·šã®å¤ªã•2ãƒ”ã‚¯ã‚»ãƒ«
                fill(col);            // å¡—ã‚Šã¤ã¶ã—è‰²ã‚’è¨­å®š
                circle(this.x, this.y, size); // å††ã‚’æç”»

                // ========== ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šç·šã®æç”» ==========
                // æ¡ç”¨è€…åŒå£«ã®ã¤ãªãŒã‚Šã‚’ç·šã§å¯è¦–åŒ–
                if (this.state === 2) {
                    stroke(65, 105, 225, 50);  // è–„ã„é’è‰²ã®ç·š
                    strokeWeight(1);           // ç´°ã„ç·š

                    // forEachï¼šå„è¿‘éš£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å¯¾ã—ã¦å‡¦ç†
                    this.neighbors.forEach(n => {
                        // ç›¸æ‰‹ã‚‚æ¡ç”¨è€…ãªã‚‰ç·šã‚’å¼•ã
                        if (n.state === 2) {
                            line(this.x, this.y, n.x, n.y);
                        }
                    });
                }

                pop(); // æç”»è¨­å®šã‚’å…ƒã«æˆ»ã™
            }
        }
        
        // ========================================
        // setup: p5.jsã®åˆæœŸåŒ–é–¢æ•°
        // ========================================
        // ãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹æ™‚ã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹ç‰¹åˆ¥ãªé–¢æ•°
        function setup() {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆæç”»é ˜åŸŸï¼‰ã‚’ä½œæˆ
            // createCanvasã¯p5.jsã®é–¢æ•°ã§ã€æŒ‡å®šã‚µã‚¤ã‚ºã®æç”»é ˜åŸŸã‚’ä½œã‚‹
            canvas = createCanvas(CANVAS_WIDTH, CANVAS_HEIGHT);

            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’HTMLå†…ã®ç‰¹å®šã®è¦ç´ ã«é…ç½®
            // 'canvasContainer'ã¨ã„ã†IDã‚’æŒã¤divè¦ç´ ã®ä¸­ã«å…¥ã‚Œã‚‹
            canvas.parent('canvasContainer');

            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆãªã©ï¼‰
            initializeSimulation();

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ãŸã¨ãã®å‡¦ç†ã‚’ç™»éŒ²
            setupSliderListeners();

            // ã‚°ãƒ©ãƒ•ã®åˆæœŸåŒ–ï¼ˆPlotly.jsã‚’ä½¿ç”¨ï¼‰
            initializeCharts();
        }
        
        // ========================================
        // draw: p5.jsã®ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—é–¢æ•°
        // ========================================
        // æ¯ç§’ç´„60å›è‡ªå‹•çš„ã«å‘¼ã°ã‚Œã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        function draw() {
            // ========== èƒŒæ™¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æç”» ==========
            // ä¸Šã‹ã‚‰ä¸‹ã«å‘ã‹ã£ã¦è‰²ãŒå¤‰åŒ–ã™ã‚‹ç¾ã—ã„èƒŒæ™¯ã‚’ä½œæˆ
            for(let i = 0; i <= CANVAS_HEIGHT; i++) {
                // mapé–¢æ•°ï¼šå€¤ã‚’åˆ¥ã®ç¯„å›²ã«å¤‰æ›
                // iï¼ˆ0ã€œCANVAS_HEIGHTï¼‰ã‚’0ã€œ1ã®ç¯„å›²ã«å¤‰æ›
                let inter = map(i, 0, CANVAS_HEIGHT, 0, 1);

                // lerpColorï¼š2ã¤ã®è‰²ã®é–“ã‚’è£œé–“ï¼ˆãƒ–ãƒ¬ãƒ³ãƒ‰ï¼‰
                // è–„ã„é’(240,248,255)ã‹ã‚‰ç™½(255,255,255)ã¸å¾ã€…ã«å¤‰åŒ–
                let c = lerpColor(color(240, 248, 255), color(255, 255, 255), inter);

                // æ¨ªç·šã‚’å¼•ã„ã¦èƒŒæ™¯ã‚’å¡—ã‚‹
                stroke(c);                    // ç·šã®è‰²ã‚’è¨­å®š
                line(0, i, CANVAS_WIDTH, i);  // å·¦ç«¯ã‹ã‚‰å³ç«¯ã¾ã§æ¨ªç·š
            }

            // ========== ã‚°ãƒªãƒƒãƒ‰ï¼ˆæ ¼å­ï¼‰ã®æç”» ==========
            // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½ç½®ã‚’æŠŠæ¡ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®è£œåŠ©ç·š
            stroke(200, 50);      // ã‚°ãƒ¬ãƒ¼è‰²ã€é€æ˜åº¦50
            strokeWeight(0.5);    // ç´°ã„ç·š

            // ç¸¦ç·šã‚’50ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«æç”»
            for(let x = 0; x < CANVAS_WIDTH; x += 50) {
                line(x, 0, x, CANVAS_HEIGHT);
            }

            // æ¨ªç·šã‚’50ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«æç”»
            for(let y = 0; y < CANVAS_HEIGHT; y += 50) {
                line(0, y, CANVAS_WIDTH, y);
            }
            
            // ========== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå‡¦ç† ==========
            if (isRunning) {  // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œä¸­ã®å ´åˆã®ã¿

                // ========== UIã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾— ==========
                // HTMLã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‹ã‚‰ç¾åœ¨ã®å€¤ã‚’èª­ã¿å–ã‚‹
                // parseFloatï¼šæ–‡å­—åˆ—ã‚’å°æ•°ã«å¤‰æ›
                let techPU = parseFloat(document.getElementById('usefulness').value);
                let techPEOU = parseFloat(document.getElementById('easeOfUse').value);
                let socialInf = parseFloat(document.getElementById('socialInfluence').value);

                // ========== ã™ã¹ã¦ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ›´æ–° ==========
                // forEachï¼šé…åˆ—ã®å„è¦ç´ ã«å¯¾ã—ã¦å‡¦ç†ã‚’å®Ÿè¡Œ
                agents.forEach(agent => {
                    // å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆç§»å‹•ã¨æ„æ€æ±ºå®šï¼‰
                    agent.update(techPU, techPEOU, socialInf);
                });

                // æ™‚é–“ã‚’1ã‚¹ãƒ†ãƒƒãƒ—é€²ã‚ã‚‹
                time++;

                // ========== å®šæœŸçš„ãªçµ±è¨ˆæ›´æ–° ==========
                // %ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ­ï¼‰æ¼”ç®—å­ï¼šä½™ã‚Šã‚’è¨ˆç®—
                // time % 5 === 0 ã¯ã€Œ5ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã€ã‚’æ„å‘³
                if (time % 5 === 0) {
                    updateStatistics();  // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
                    updateCharts();      // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                }
            }
            
            // ========== ã™ã¹ã¦ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æç”» ==========
            // å®Ÿè¡Œä¸­ã§ãªãã¦ã‚‚æç”»ã¯è¡Œã†ï¼ˆä¸€æ™‚åœæ­¢ä¸­ã‚‚è¡¨ç¤ºï¼‰
            agents.forEach(agent => {
                agent.display();
            });

            // ========== çµŒéæ™‚é–“ã‚’UIã«è¡¨ç¤º ==========
            // HTMLã®è¦ç´ ã«ç¾åœ¨ã®æ™‚é–“ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
            document.getElementById('timeStep').textContent = time;
        }
        
        // ========================================
        // initializeSimulation: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
        // ========================================
        // ãƒªã‚»ãƒƒãƒˆæ™‚ã‚„æœ€åˆã®èµ·å‹•æ™‚ã«å‘¼ã°ã‚Œã‚‹
        function initializeSimulation() {
            // ========== å¤‰æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ ==========
            agents = [];           // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé…åˆ—ã‚’ç©ºã«ã™ã‚‹
            time = 0;             // æ™‚é–“ã‚’0ã«æˆ»ã™
            adoptionHistory = []; // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢

            // ========== ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç”Ÿæˆ ==========
            for(let i = 0; i < NUM_AGENTS; i++) {
                // ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã‚’æ±ºå®š
                // random(min, max)ï¼šminä»¥ä¸Šmaxæœªæº€ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤
                // ç«¯ã‹ã‚‰20ãƒ”ã‚¯ã‚»ãƒ«å†…å´ã«é…ç½®ï¼ˆç«¯ã«è¡Œãã™ããªã„ã‚ˆã†ã«ï¼‰
                let x = random(20, CANVAS_WIDTH - 20);
                let y = random(20, CANVAS_HEIGHT - 20);

                // æ–°ã—ã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã—ã¦é…åˆ—ã«è¿½åŠ 
                // pushï¼šé…åˆ—ã®æœ€å¾Œã«è¦ç´ ã‚’è¿½åŠ 
                agents.push(new Agent(x, y, i));
            }

            // ========== ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ï¼ˆåˆæœŸæ¡ç”¨è€…ï¼‰ã®è¨­å®š ==========
            // Rogersç†è«–ï¼šæœ€åˆã‹ã‚‰æŠ€è¡“ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹å…ˆé§†è€…ãŸã¡

            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§è¨­å®šã•ã‚ŒãŸå‰²åˆã‹ã‚‰ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼æ•°ã‚’è¨ˆç®—
            // Math.floorï¼šå°æ•°ç‚¹ä»¥ä¸‹ã‚’åˆ‡ã‚Šæ¨ã¦
            let innovatorCount = Math.floor(NUM_AGENTS * parseFloat(document.getElementById('innovators').value) / 100);

            // æœ€åˆã®Näººã‚’ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦è¨­å®š
            for(let i = 0; i < innovatorCount; i++) {
                agents[i].state = 2;           // æœ€åˆã‹ã‚‰æ¡ç”¨çŠ¶æ…‹
                agents[i].innovativeness = 95; // é«˜ã„é©æ–°æ€§ã‚’æŒã¤
            }

            // åˆæœŸçŠ¶æ…‹ã®çµ±è¨ˆã‚’è¨ˆç®—
            updateStatistics();
        }
        
        // ========================================
        // updateStatistics: çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
        // ========================================
        // ç¾åœ¨ã®å„çŠ¶æ…‹ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ã‚’é›†è¨ˆã—ã¦UIã«è¡¨ç¤º
        function updateStatistics() {
            // ========== å„çŠ¶æ…‹ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ ==========
            // filterï¼šæ¡ä»¶ã«åˆã†è¦ç´ ã ã‘ã‚’æŠ½å‡º
            // lengthï¼šé…åˆ—ã®è¦ç´ æ•°ã‚’å–å¾—

            // æ¡ç”¨è€…ï¼ˆstate === 2ï¼‰ã®æ•°
            let adopters = agents.filter(a => a.state === 2).length;

            // æ¤œè¨ä¸­ï¼ˆstate === 1ï¼‰ã®æ•°
            let considering = agents.filter(a => a.state === 1).length;

            // æ‹’å¦è€…ï¼ˆstate === 3ï¼‰ã®æ•°
            let rejected = agents.filter(a => a.state === 3).length;

            // ========== UIã«è¡¨ç¤º ==========
            // æ¡ç”¨è€…æ•°ã¨å‰²åˆ
            document.getElementById('adopters').textContent = adopters;
            // toFixed(1)ï¼šå°æ•°ç¬¬1ä½ã¾ã§è¡¨ç¤ºï¼ˆä¾‹ï¼š45.3%ï¼‰
            document.getElementById('adoptersPercent').textContent =
                `${(adopters / NUM_AGENTS * 100).toFixed(1)}%`;

            // æ¤œè¨ä¸­ã®æ•°ã¨å‰²åˆ
            document.getElementById('considering').textContent = considering;
            document.getElementById('consideringPercent').textContent =
                `${(considering / NUM_AGENTS * 100).toFixed(1)}%`;

            // ========== å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è¨˜éŒ² ==========
            // ã‚°ãƒ©ãƒ•æç”»ç”¨ã«æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            adoptionHistory.push({
                time: time,                    // ç¾åœ¨ã®æ™‚åˆ»
                adopters: adopters,           // æ¡ç”¨è€…æ•°
                considering: considering,     // æ¤œè¨ä¸­ã®æ•°
                rejected: rejected,           // æ‹’å¦è€…æ•°
                // æœªèªçŸ¥è€…æ•°ã¯å…¨ä½“ã‹ã‚‰ä»–ã‚’å¼•ã„ã¦è¨ˆç®—
                unaware: NUM_AGENTS - adopters - considering - rejected
            });
        }
        
        // ========================================
        // setupSliderListeners: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚’è¨­å®š
        // ========================================
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ãŸã¨ãã«å€¤ã®è¡¨ç¤ºã‚’æ›´æ–°
        function setupSliderListeners() {
            // addEventListenerï¼šã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã¨ãã®å‡¦ç†ã‚’ç™»éŒ²
            // 'input'ã‚¤ãƒ™ãƒ³ãƒˆï¼šã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ãŒå¤‰ã‚ã‚‹ãŸã³ã«ç™ºç”Ÿ

            // ========== æŠ€è¡“ã®æœ‰ç”¨æ€§ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ ==========
            document.getElementById('usefulness').addEventListener('input', function(e) {
                // e.target.valueï¼šã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ç¾åœ¨ã®å€¤
                // ãã‚Œã‚’è¡¨ç¤ºç”¨ã®è¦ç´ ã«åæ˜ 
                document.getElementById('usefulnessValue').textContent = e.target.value;
            });

            // ========== æŠ€è¡“ã®ä½¿ã„ã‚„ã™ã•ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ ==========
            document.getElementById('easeOfUse').addEventListener('input', function(e) {
                document.getElementById('easeOfUseValue').textContent = e.target.value;
            });

            // ========== ç¤¾ä¼šçš„å½±éŸ¿åŠ›ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ ==========
            document.getElementById('socialInfluence').addEventListener('input', function(e) {
                document.getElementById('socialInfluenceValue').textContent = e.target.value;
            });

            // ========== ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼æ¯”ç‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ ==========
            document.getElementById('innovators').addEventListener('input', function(e) {
                // %è¨˜å·ã‚’è¿½åŠ ã—ã¦è¡¨ç¤º
                document.getElementById('innovatorsValue').textContent = e.target.value + '%';
            });
        }
        
        // ========================================
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡é–¢æ•°
        // ========================================

        // startSimulation: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å‘¼ã°ã‚Œã‚‹
        function startSimulation() {
            isRunning = true;  // ãƒ•ãƒ©ã‚°ã‚’trueã«ã—ã¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
        }

        // pauseSimulation: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€æ™‚åœæ­¢
        // å®Ÿè¡Œã‚’æ­¢ã‚ã‚‹ãŒã€ç¾åœ¨ã®çŠ¶æ…‹ã¯ä¿æŒ
        function pauseSimulation() {
            isRunning = false; // ãƒ•ãƒ©ã‚°ã‚’falseã«ã—ã¦åœæ­¢
        }

        // resetSimulation: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
        // ã™ã¹ã¦ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
        function resetSimulation() {
            isRunning = false;           // ã¾ãšåœæ­¢
            initializeSimulation();      // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å†ç”Ÿæˆ
            initializeCharts();          // ã‚°ãƒ©ãƒ•ã‚‚ãƒªã‚»ãƒƒãƒˆ
        }
        
        // ========================================
        // initializeCharts: ã‚°ãƒ©ãƒ•ã‚’åˆæœŸåŒ–ï¼ˆPlotly.jsä½¿ç”¨ï¼‰
        // ========================================
        // 2ã¤ã®ã‚°ãƒ©ãƒ•ï¼ˆæ™‚ç³»åˆ—ã¨å††ã‚°ãƒ©ãƒ•ï¼‰ã‚’æº–å‚™
        function initializeCharts() {
            // ========== æ¡ç”¨ç‡æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆï¼ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼‰==========

            // trace1: æ¡ç”¨è€…æ•°ã®æ¨ç§»ã‚’è¡¨ã™ãƒ‡ãƒ¼ã‚¿
            let trace1 = {
                x: [0],                      // Xè»¸ãƒ‡ãƒ¼ã‚¿ï¼ˆæ™‚é–“ï¼‰ã€åˆæœŸå€¤0
                y: [0],                      // Yè»¸ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¡ç”¨è€…æ•°ï¼‰ã€åˆæœŸå€¤0
                type: 'scatter',             // æ•£å¸ƒå›³ã‚¿ã‚¤ãƒ—ï¼ˆç·šã§ã¤ãªãï¼‰
                mode: 'lines',               // ç·šã®ã¿è¡¨ç¤ºï¼ˆç‚¹ã¯è¡¨ç¤ºã—ãªã„ï¼‰
                name: 'æ¡ç”¨è€…',              // å‡¡ä¾‹ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰
                line: {color: '#4169E1', width: 3}  // é’è‰²ã€ç·šã®å¤ªã•3
            };
            
            let trace2 = {
                x: [0],
                y: [0],
                type: 'scatter',
                mode: 'lines',
                name: 'æ¤œè¨ä¸­',
                line: {color: '#FFD700', width: 2}
            };
            
            let layout1 = {
                height: 250,
                margin: {t: 20, r: 20, b: 40, l: 50},
                xaxis: {title: 'æ™‚é–“'},
                yaxis: {title: 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°'},
                showlegend: true,
                legend: {x: 0, y: 1}
            };
            
            Plotly.newPlot('adoptionChart', [trace1, trace2], layout1, {displayModeBar: false});
            
            // ========== åˆ†å¸ƒãƒãƒ£ãƒ¼ãƒˆï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰==========

            // trace3: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹åˆ†å¸ƒã‚’è¡¨ã™å††ã‚°ãƒ©ãƒ•
            let trace3 = {
                values: [NUM_AGENTS, 0, 0, 0],  // åˆæœŸå€¤ï¼šå…¨å“¡ãŒæœªèªçŸ¥
                labels: ['æœªèªçŸ¥', 'æ¤œè¨ä¸­', 'æ¡ç”¨', 'æ‹’å¦'],  // å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ©ãƒ™ãƒ«
                type: 'pie',                    // å††ã‚°ãƒ©ãƒ•
                marker: {
                    // å„çŠ¶æ…‹ã®è‰²ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¡¨ç¤ºã¨åŒã˜è‰²ã‚’ä½¿ç”¨ï¼‰
                    colors: ['#D3D3D3', '#FFD700', '#4169E1', '#FF6B6B']
                    //        ã‚°ãƒ¬ãƒ¼     é»„è‰²       é’        èµ¤
                }
            };
            
            let layout2 = {
                height: 250,
                margin: {t: 20, r: 20, b: 20, l: 20}
            };
            
            Plotly.newPlot('distributionChart', [trace3], layout2, {displayModeBar: false});
        }
        
        // ========================================
        // updateCharts: ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
        // ========================================
        // æœ€æ–°ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã§ã‚°ãƒ©ãƒ•ã‚’å†æç”»
        function updateCharts() {
            // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿æ›´æ–°
            if (adoptionHistory.length > 0) {
                // æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—
                // length - 1ï¼šé…åˆ—ã®æœ€å¾Œã®è¦ç´ ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                let latest = adoptionHistory[adoptionHistory.length - 1];

                // ========== æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•ã®æ›´æ–° ==========

                // mapé–¢æ•°ï¼šé…åˆ—ã®å„è¦ç´ ã‚’å¤‰æ›ã—ã¦æ–°ã—ã„é…åˆ—ã‚’ä½œæˆ
                // å±¥æ­´ã‹ã‚‰æ™‚é–“ã®é…åˆ—ã‚’ä½œæˆ
                let times = adoptionHistory.map(h => h.time);

                // å±¥æ­´ã‹ã‚‰æ¡ç”¨è€…æ•°ã®é…åˆ—ã‚’ä½œæˆ
                let adopters = adoptionHistory.map(h => h.adopters);

                // å±¥æ­´ã‹ã‚‰æ¤œè¨ä¸­æ•°ã®é…åˆ—ã‚’ä½œæˆ
                let considering = adoptionHistory.map(h => h.considering);

                // Plotly.updateï¼šæ—¢å­˜ã®ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°ï¼ˆå†æç”»ã‚ˆã‚Šé«˜é€Ÿï¼‰
                // å¼•æ•°ï¼š(ã‚°ãƒ©ãƒ•ID, æ–°ãƒ‡ãƒ¼ã‚¿, ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´, ãƒˆãƒ¬ãƒ¼ã‚¹ç•ªå·)
                Plotly.update('adoptionChart', {
                    x: [times, times],           // ä¸¡æ–¹ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã«åŒã˜Xè»¸ãƒ‡ãƒ¼ã‚¿
                    y: [adopters, considering]   // ãã‚Œãã‚Œã®Yè»¸ãƒ‡ãƒ¼ã‚¿
                }, {}, [0, 1]);                 // ãƒˆãƒ¬ãƒ¼ã‚¹0ã¨1ã‚’æ›´æ–°

                // ========== å††ã‚°ãƒ©ãƒ•ã®æ›´æ–° ==========

                // æœ€æ–°ã®çŠ¶æ…‹åˆ†å¸ƒã§å††ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                Plotly.update('distributionChart', {
                    // äºŒé‡é…åˆ—ã«ã™ã‚‹ç†ç”±ï¼šPlotlyã®ä»•æ§˜
                    values: [[latest.unaware, latest.considering, latest.adopters, latest.rejected]]
                }, {}, [0]);  // ãƒˆãƒ¬ãƒ¼ã‚¹0ï¼ˆå”¯ä¸€ã®ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰ã‚’æ›´æ–°
            }
        }
    </script>
</body>
</html>